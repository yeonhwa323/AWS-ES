/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){function t(t){for(var n,s,i=t[0],r=t[1],c=0,l=[];c<i.length;c++)s=i[c],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&l.push(a[s][0]),a[s]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);for(o&&o(t);l.length;)l.shift()()}var n={},a={0:0};function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,s){n=a[e]=[t,s]}));t.push(n[2]=i);var r,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=function(e){return s.p+"savedObjectsTagging.chunk."+e+".js"}(e);var o=new Error;r=function(t){c.onerror=c.onload=null,clearTimeout(l);var n=a[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;o.message="Loading chunk "+e+" failed.\n("+s+": "+i+")",o.name="ChunkLoadError",o.type=s,o.request=i,n[1](o)}a[e]=void 0}};var l=setTimeout((function(){r({type:"timeout",target:c})}),12e4);c.onerror=c.onload=r,document.head.appendChild(c)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var i=window.savedObjectsTagging_bundle_jsonpfunction=window.savedObjectsTagging_bundle_jsonpfunction||[],r=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var o=r;s(s.s=23)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return g})),n.d(t,"g",(function(){return d})),n.d(t,"e",(function(){return h}));var a=n(13),s=(n(15),n(5));const i=e=>({type:s.c,id:e,name:`tag-ref-${e}`}),r=(e,t)=>[...e.filter((({type:e})=>e!==s.c)),...t.map(i)],c=(e,t)=>o(e.references,t),o=(e,t)=>{const n=e.filter((e=>e.type===a.d)),s=[],i=[];return n.forEach((e=>{const n=t.find((t=>t.id===e.id));n?s.push(n):i.push(e)})),{tags:s,missingRefs:i}},l=(e,t)=>{const n=t.find((t=>t.name===e));return null==n?void 0:n.id},u=(e,t)=>e.name.localeCompare(t.name),g=(e,t)=>t.find((({id:t})=>t===e)),d=e=>e.replace(" ","_"),h=e=>e.filter((e=>e.type===a.d)).map((({id:e})=>e))},function(e,t,n){e.exports=n(20)(1075)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return i}));const a="savedObjectsTagging",s="tag",i="tags"},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"d",(function(){return b})),n.d(t,"c",(function(){return v}));var a=n(1),s=n(2),i=n(0);const r=({tag:e})=>Object(i.jsx)(s.EuiBadge,{color:e.color,title:e.description},e.name),c=({tags:e})=>Object(i.jsx)(s.EuiBadgeGroup,null,e.map((e=>Object(i.jsx)(r,{key:e.name,tag:e}))));var o=n(8),l=n.n(o),u=n(10),g=n(3);const d={type:"__create_option__"};function h(e){const t=e.value;return void 0!==t.name&&void 0!==t.color&&void 0!==t.id}function p(e){return"__create_option__"===e.value.type}const f=(e,t,n)=>p(e)?Object(i.jsx)(s.EuiFlexGroup,{"data-test-subj":"tagSelectorOption-action__create",gutterSize:"xs",alignItems:"center",responsive:!1},Object(i.jsx)(s.EuiFlexItem,{grow:!1},Object(i.jsx)(s.EuiIcon,{type:"tag"})),Object(i.jsx)(s.EuiFlexItem,{grow:!1},Object(i.jsx)("span",null,Object(i.jsx)(u.FormattedMessage,{id:"xpack.savedObjectsTagging.components.tagSelector.createTagOptionLabel",defaultMessage:"Create tag"})))):h(e)?((e,t,n)=>{var a;const{name:r,color:c}=null!==(a=e.value)&&void 0!==a?a:{name:""};return Object(i.jsx)(s.EuiHealth,{color:c,"data-test-subj":`tagSelectorOption-${Object(g.g)(r)}`},Object(i.jsx)("span",{className:n},Object(i.jsx)(s.EuiHighlight,{search:t},r)))})(e,t,n):void 0,b=({tags:e,selected:t,onTagsSelected:n,allowCreate:r,openCreateModal:c,...o})=>{const[u,g]=Object(a.useState)(""),b=Object(a.useMemo)((()=>({label:`${u} `,color:"#FFFFFF",value:d})),[u]),v=Object(a.useMemo)((()=>[...e.map((e=>({label:e.name,color:e.color,value:e}))),...r?[b]:[]]),[r,e,b]),j=Object(a.useMemo)((()=>v.filter((e=>h(e)&&t.includes(e.value.id)))),[t,v]),_=Object(a.useCallback)((e=>{const a=e.filter(h).map((e=>e.value.id));n(a),e.find(p)&&c({defaultValues:{name:u},onCreate:e=>{n([...t,e.id])}})}),[t,n,c,u]);return Object(i.jsx)(s.EuiComboBox,l()({placeholder:"",options:v,selectedOptions:j,onSearchChange:g,onChange:_,renderOption:f},o))},v=({tag:e})=>{const{name:t,color:n}=e;return Object(i.jsx)(s.EuiHealth,{color:n,"data-test-subj":`tag-searchbar-option-${Object(g.g)(t)}`},Object(i.jsx)("span",null,Object(i.jsx)(s.EuiText,null,t)))}},function(e,t,n){e.exports=n(20)(1076)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(22),s=n(1),i=a.__importDefault(n(25));t.default=function(e,t){var n=s.useState(t),a=n[0],r=n[1];return i.default((function(){var t=e.subscribe(r);return function(){return t.unsubscribe()}}),[e]),a}},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,n){"use strict";n.d(t,"b",(function(){return tags_client_TagsClient})),n.d(t,"a",(function(){return tags_cache_TagsCache})),n.d(t,"c",(function(){return o}));var a=n(4),s=n.n(a);const i=e=>{try{e()}catch(e){}};class tags_client_TagsClient{constructor({http:e,changeListener:t}){s()(this,"http",void 0),s()(this,"changeListener",void 0),this.http=e,this.changeListener=t}async create(e){const{tag:t}=await this.http.post("/api/saved_objects_tagging/tags/create",{body:JSON.stringify(e)});return i((()=>{this.changeListener&&this.changeListener.onCreate(t)})),t}async update(e,t){const{tag:n}=await this.http.post(`/api/saved_objects_tagging/tags/${e}`,{body:JSON.stringify(t)});return i((()=>{if(this.changeListener){const{id:e,...t}=n;this.changeListener.onUpdate(e,t)}})),n}async get(e){const{tag:t}=await this.http.get(`/api/saved_objects_tagging/tags/${e}`);return t}async getAll({asSystemRequest:e}={}){const t={asSystemRequest:e},{tags:n}=await this.http.get("/api/saved_objects_tagging/tags",t);return i((()=>{this.changeListener&&this.changeListener.onGetAll(n)})),n}async delete(e){await this.http.delete(`/api/saved_objects_tagging/tags/${e}`),i((()=>{this.changeListener&&this.changeListener.onDelete(e)}))}async find({page:e,perPage:t,search:n}){return await this.http.get("/internal/saved_objects_tagging/tags/_find",{query:{page:e,perPage:t,search:n}})}async bulkDelete(e){await this.http.post("/internal/saved_objects_tagging/tags/_bulk_delete",{body:JSON.stringify({ids:e})}),i((()=>{this.changeListener&&e.forEach((e=>{this.changeListener.onDelete(e)}))}))}}var r=n(14),c=n(18);class tags_cache_TagsCache{constructor({refreshHandler:e,refreshInterval:t}){s()(this,"refreshInterval",void 0),s()(this,"refreshHandler",void 0),s()(this,"intervalId",void 0),s()(this,"internal$",void 0),s()(this,"public$",void 0),s()(this,"stop$",void 0),this.refreshHandler=e,this.refreshInterval=t,this.stop$=new r.Subject,this.internal$=new r.BehaviorSubject([]),this.public$=this.internal$.pipe(Object(c.takeUntil)(this.stop$))}async initialize(){await this.refresh(),this.refreshInterval&&(this.intervalId=window.setInterval((()=>{this.refresh()}),this.refreshInterval.asMilliseconds()))}async refresh(){try{const e=await this.refreshHandler();this.internal$.next(e)}catch(e){}}getState(){return this.internal$.getValue()}getState$(){return this.public$}onDelete(e){this.internal$.next(this.internal$.value.filter((t=>t.id!==e)))}onCreate(e){this.internal$.next([...this.internal$.value.filter((t=>t.id!==e.id)),e])}onUpdate(e,t){this.internal$.next(this.internal$.value.map((n=>n.id===e?{...n,...t}:n)))}onGetAll(e){this.internal$.next(e)}stop(){this.intervalId&&window.clearInterval(this.intervalId),this.stop$.next()}}const o=e=>{var t;return e&&400===e.statusCode&&"boolean"==typeof(null===(t=e.attributes)||void 0===t?void 0:t.valid)&&"object"==typeof e.attributes.errors}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(5);const s=e=>{var t,n,s,i,r,c,o;const l=e[a.a];return{view:null!==(t=null==l?void 0:l.view)&&void 0!==t&&t,create:null!==(n=null==l?void 0:l.create)&&void 0!==n&&n,edit:null!==(s=null==l?void 0:l.edit)&&void 0!==s&&s,delete:null!==(i=null==l?void 0:l.delete)&&void 0!==i&&i,assign:null!==(r=null==l?void 0:l.assign)&&void 0!==r&&r,viewConnections:null!==(c=null===(o=e.savedObjectsManagement)||void 0===o?void 0:o.read)&&void 0!==c&&c}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a.a})),n.d(t,"d",(function(){return s.c})),n.d(t,"e",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return g})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return c}));var a=n(12),s=n(5),i=n(6);const r=50,c=100,o=/^#[0-9A-F]{6}$/i,l=e=>{if(!(e=>o.test(e))(e))return i.i18n.translate("xpack.savedObjectsTagging.validation.color.errorInvalid",{defaultMessage:"Tag color must be a valid hex color"})},u=e=>e.length<2?i.i18n.translate("xpack.savedObjectsTagging.validation.name.errorTooShort",{defaultMessage:"Tag name must be at least {length} characters",values:{length:2}}):e.length>r?i.i18n.translate("xpack.savedObjectsTagging.validation.name.errorTooLong",{defaultMessage:"Tag name may not exceed {length} characters",values:{length:r}}):void 0,g=e=>{if(e.length>c)return i.i18n.translate("xpack.savedObjectsTagging.validation.description.errorTooLong",{defaultMessage:"Tag description may not exceed {length} characters",values:{length:c}})}},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,n){n.r(t);var a=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,n){"use strict";var a=n(7);n.d(t,"a",(function(){return a.a})),n.d(t,"b",(function(){return a.c}))},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,n){"use strict";n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return d}));var a=n(1),s=n.n(a),i=n(2),r=n(16),c=n(0);const o=()=>Object(c.jsx)(i.EuiDelayRender,null,Object(c.jsx)(i.EuiLoadingSpinner,null)),l=s.a.lazy((()=>n.e(3).then(n.bind(null,52)).then((({CreateTagModal:e})=>({default:e}))))),u=s.a.lazy((()=>n.e(4).then(n.bind(null,53)).then((({EditTagModal:e})=>({default:e}))))),g=({overlays:e,tagClient:t})=>async({onCreate:n,defaultValues:a})=>{const i=e.openModal(Object(r.toMountPoint)(Object(c.jsx)(s.a.Suspense,{fallback:Object(c.jsx)(o,null)},Object(c.jsx)(l,{defaultValues:a,onClose:()=>{i.close()},onSave:e=>{i.close(),n(e)},tagClient:t}))));return i},d=({overlays:e,tagClient:t})=>async({tagId:n,onUpdate:a})=>{const i=await t.get(n),l=e.openModal(Object(r.toMountPoint)(Object(c.jsx)(s.a.Suspense,{fallback:Object(c.jsx)(o,null)},Object(c.jsx)(u,{tag:i,onClose:()=>{l.close()},onSave:e=>{l.close(),a(e)},tagClient:t}))));return l}},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,n){n(24),__kbnBundles__.define("plugin/savedObjectsTagging/public",n,26)},function(e,t,n){n.p=window.__kbnPublicPath__.savedObjectsTagging},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s="undefined"!=typeof window?a.useLayoutEffect:a.useEffect;t.default=s},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return I}));var a=n(4),s=n.n(a),i=n(6),r=n(5),c=n(12),o=n(11);class assignment_service_TagAssignmentService{constructor({http:e}){s()(this,"http",void 0),this.http=e}async findAssignableObjects({search:e,types:t,maxResults:n}){const{objects:a}=await this.http.get("/internal/saved_objects_tagging/assignments/_find_assignable_objects",{query:{search:e,types:t,max_results:n}});return a}async updateTagAssignments({tags:e,assign:t,unassign:n}){await this.http.post("/api/saved_objects_tagging/assignments/update_by_tags",{body:JSON.stringify({tags:e,assign:t,unassign:n})})}async getAssignableTypes(){const{types:e}=await this.http.get("/internal/saved_objects_tagging/assignments/_assignable_types");return e}}var l=n(3),u=n(8),g=n.n(u),d=n(1),h=n(9),p=n.n(h),f=n(7),b=n(0);const v=({object:e,tags:t})=>{const n=Object(d.useMemo)((()=>{const{tags:n}=Object(l.c)(e,t);return n.sort(l.a),n}),[e,t]);return Object(b.jsx)(f.b,{tags:n})},j=({cache:e})=>t=>{const n=p()(e.getState$(),e.getState());return Object(b.jsx)(v,g()({},t,{tags:n}))},_=({cache:e,capabilities:t,openCreateModal:n})=>a=>{const s=p()(e.getState$(),e.getState());return Object(b.jsx)(f.d,g()({},a,{tags:s,allowCreate:t.create,openCreateModal:n}))};var m=n(2),O=n(10);const y=({cache:e,capabilities:t,openCreateModal:n})=>({initialSelection:a,onTagsSelected:s})=>{const i=p()(e.getState$(),e.getState()),[r,c]=Object(d.useState)(a),o=Object(d.useCallback)((e=>{c(e),s(e)}),[s]);return Object(b.jsx)(m.EuiFormRow,{fullWidth:!0,label:Object(b.jsx)(O.FormattedMessage,{id:"xpack.savedObjectsTagging.uiApi.saveModal.label",defaultMessage:"Tags"})},Object(b.jsx)(f.d,{selected:r,onTagsSelected:o,tags:i,"data-test-subj":"savedObjectTagSelector",allowCreate:t.create,openCreateModal:n}))};var x=n(19);const S=({components:e,cache:t})=>()=>({field:"references",name:i.i18n.translate("xpack.savedObjectsTagging.uiApi.table.columnTagsName",{defaultMessage:"Tags"}),description:i.i18n.translate("xpack.savedObjectsTagging.uiApi.table.columnTagsDescription",{defaultMessage:"Tags associated with this saved object"}),sortable:e=>{const{tags:n}=Object(l.f)(e.references,t.getState());return n.sort(l.a),n.length?n[0].name:void 0},render:(t,n)=>Object(b.jsx)(e.TagList,{object:n}),"data-test-subj":"listingTableRowTags"});var T=n(17);const C=({cache:e})=>({useName:t=!0,tagField:n="tag"}={})=>({type:"field_value_selection",field:n,name:i.i18n.translate("xpack.savedObjectsTagging.uiApi.searchBar.filterButtonLabel",{defaultMessage:"Tags"}),multiSelect:"or",options:()=>Promise.resolve(e.getState().sort(l.a).map((e=>({value:t?e.name:e.id,name:e.name,view:Object(b.jsx)(T.b,{tag:e})}))))}),w=({cache:e})=>(t,{tagField:n="tag",useName:a=!0}={})=>{let s;try{s=m.Query.parse(t)}catch(e){return{searchTerm:t,tagReferences:[],valid:!1}}if(!t)return{searchTerm:"",tagReferences:[],valid:!0};let i="",r=[];if(s.ast.getTermClauses().length&&(i=s.ast.getTermClauses().map((e=>e.value)).join(" ")),s.ast.getFieldClauses(n)){const t=s.ast.getFieldClauses(n)[0].value;a?t.forEach((t=>{const n=e.getState().find((e=>e.name===t));n&&r.push({type:"tag",id:n.id})})):r=t.map((e=>({type:"tag",id:e})))}return{searchTerm:i,tagReferences:r,valid:!0}},M=({cache:e})=>t=>{const n=Object(l.b)(t,e.getState());return n?{type:"tag",id:n}:void 0},k=e=>"getTags"in e&&"setTags"in e,$=({cache:e,capabilities:t,client:n,overlays:a})=>{const s=(({capabilities:e,cache:t,overlays:n,tagClient:a})=>{const s=Object(x.a)({overlays:n,tagClient:a});return{TagList:j({cache:t}),TagSelector:_({cache:t,capabilities:e,openCreateModal:s}),SavedObjectSaveModalTagSelector:y({cache:t,capabilities:e,openCreateModal:s})}})({cache:e,capabilities:t,overlays:a,tagClient:n});return{components:s,getTableColumnDefinition:S({components:s,cache:e}),getSearchBarFilter:C({cache:e}),parseSearchQuery:w({cache:e}),convertNameToReference:M({cache:e}),hasTagDecoration:k,getTagIdsFromReferences:l.e,getTagIdFromName:t=>Object(l.b)(t,e.getState()),updateTagsReferences:l.h,getTag:t=>Object(l.d)(t,e.getState())}};var L=n(21),E=n.n(L);class config_SavedObjectsTaggingClientConfig{constructor(e){s()(this,"cacheRefreshInterval",void 0),this.cacheRefreshInterval=E.a.duration(e.cache_refresh_interval)}}class plugin_SavedObjectTaggingPlugin{constructor(e){s()(this,"tagClient",void 0),s()(this,"tagCache",void 0),s()(this,"assignmentService",void 0),s()(this,"config",void 0),this.config=new config_SavedObjectsTaggingClientConfig(e.config.get())}setup(e,{management:t,savedObjectsTaggingOss:a}){const s=t.sections.section.kibana,c=i.i18n.translate("xpack.savedObjectsTagging.management.sectionLabel",{defaultMessage:"Tags"});return s.registerApp({id:r.b,title:c,order:1.5,mount:async t=>{const{mountSection:a}=await n.e(1).then(n.bind(null,54));return a({tagClient:this.tagClient,tagCache:this.tagCache,assignmentService:this.assignmentService,core:e,mountParams:t,title:c})}}),a.registerTaggingApi(e.getStartServices().then((([e,t,n])=>n))),{}}start({http:e,application:t,overlays:n}){return this.tagCache=new o.a({refreshHandler:()=>this.tagClient.getAll({asSystemRequest:!0}),refreshInterval:this.config.cacheRefreshInterval}),this.tagClient=new o.b({http:e,changeListener:this.tagCache}),this.assignmentService=new assignment_service_TagAssignmentService({http:e}),e.anonymousPaths.isAnonymous(window.location.pathname)||this.tagCache.initialize().catch((()=>{})),{client:this.tagClient,cache:this.tagCache,ui:$({cache:this.tagCache,client:this.tagClient,capabilities:Object(c.a)(t.capabilities),overlays:n})}}stop(){this.tagCache&&this.tagCache.stop()}}const I=e=>new plugin_SavedObjectTaggingPlugin(e)},function(e,t){e.exports=__kbnSharedDeps__.ReactDom}]);