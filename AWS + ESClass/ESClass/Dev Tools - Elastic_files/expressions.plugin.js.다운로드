!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=35)}([function(e,t,r){e.exports=r(15)(1075)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,r){"use strict";let n,s,i,o,a,u,c;r.r(t),r.d(t,"BackgroundRepeat",(function(){return n})),r.d(t,"BackgroundSize",(function(){return s})),r.d(t,"FontStyle",(function(){return i})),r.d(t,"FontWeight",(function(){return o})),r.d(t,"Overflow",(function(){return a})),r.d(t,"TextAlignment",(function(){return u})),r.d(t,"TextDecoration",(function(){return c})),r.d(t,"isExpressionAstBuilder",(function(){return m})),r.d(t,"isExpressionAst",(function(){return g})),r.d(t,"buildExpression",(function(){return y})),r.d(t,"buildExpressionFunction",(function(){return d})),r.d(t,"formatExpression",(function(){return x})),r.d(t,"format",(function(){return p})),r.d(t,"parseExpression",(function(){return b})),r.d(t,"parse",(function(){return h})),r.d(t,"americanTypewriter",(function(){return A.americanTypewriter})),r.d(t,"arial",(function(){return A.arial})),r.d(t,"baskerville",(function(){return A.baskerville})),r.d(t,"bookAntiqua",(function(){return A.bookAntiqua})),r.d(t,"brushScript",(function(){return A.brushScript})),r.d(t,"chalkboard",(function(){return A.chalkboard})),r.d(t,"didot",(function(){return A.didot})),r.d(t,"futura",(function(){return A.futura})),r.d(t,"gillSans",(function(){return A.gillSans})),r.d(t,"helveticaNeue",(function(){return A.helveticaNeue})),r.d(t,"hoeflerText",(function(){return A.hoeflerText})),r.d(t,"lucidaGrande",(function(){return A.lucidaGrande})),r.d(t,"myriad",(function(){return A.myriad})),r.d(t,"openSans",(function(){return A.openSans})),r.d(t,"optima",(function(){return A.optima})),r.d(t,"palatino",(function(){return A.palatino})),r.d(t,"fonts",(function(){return A.fonts})),r.d(t,"getType",(function(){return w})),r.d(t,"serializeProvider",(function(){return _})),r.d(t,"ExpressionType",(function(){return expression_type_ExpressionType})),r.d(t,"typeSpecs",(function(){return X})),r.d(t,"boolean",(function(){return T})),r.d(t,"isDatatable",(function(){return R})),r.d(t,"datatable",(function(){return F})),r.d(t,"isExpressionValueError",(function(){return k})),r.d(t,"error",(function(){return I})),r.d(t,"filter",(function(){return L})),r.d(t,"image",(function(){return P})),r.d(t,"nullType",(function(){return $})),r.d(t,"num",(function(){return q})),r.d(t,"number",(function(){return D})),r.d(t,"pointseries",(function(){return B})),r.d(t,"range",(function(){return U})),r.d(t,"render",(function(){return V})),r.d(t,"shape",(function(){return W})),r.d(t,"string",(function(){return Y})),r.d(t,"style",(function(){return J})),r.d(t,"uiSetting",(function(){return K})),r.d(t,"unboxExpressionValue",(function(){return Q})),r.d(t,"ExpressionFunctionParameter",(function(){return expression_function_parameter_ExpressionFunctionParameter})),r.d(t,"ExpressionFunction",(function(){return expression_function_ExpressionFunction})),r.d(t,"clog",(function(){return ee})),r.d(t,"createTable",(function(){return te})),r.d(t,"font",(function(){return ne})),r.d(t,"variableSet",(function(){return se})),r.d(t,"variable",(function(){return ie})),r.d(t,"theme",(function(){return oe})),r.d(t,"cumulativeSum",(function(){return ce})),r.d(t,"overallMetric",(function(){return le})),r.d(t,"derivative",(function(){return pe})),r.d(t,"movingAverage",(function(){return de})),r.d(t,"getUiSettingFn",(function(){return fe})),r.d(t,"mapColumn",(function(){return ge})),r.d(t,"math",(function(){return _e})),r.d(t,"mathColumn",(function(){return je})),r.d(t,"getBucketIdentifier",(function(){return ae})),r.d(t,"buildResultColumns",(function(){return ue})),r.d(t,"ExpressionRenderer",(function(){return expression_renderer_ExpressionRenderer})),r.d(t,"ExpressionRendererRegistry",(function(){return expression_renderer_registry_ExpressionRendererRegistry})),r.d(t,"defaultState",(function(){return Oe})),r.d(t,"pureTransitions",(function(){return Te})),r.d(t,"pureSelectors",(function(){return Me})),r.d(t,"createExecutorContainer",(function(){return Se})),r.d(t,"TypesRegistry",(function(){return TypesRegistry})),r.d(t,"FunctionsRegistry",(function(){return FunctionsRegistry})),r.d(t,"Executor",(function(){return executor_Executor})),r.d(t,"executionPureTransitions",(function(){return Ne})),r.d(t,"createExecutionContainer",(function(){return Ie})),r.d(t,"Execution",(function(){return execution_Execution})),r.d(t,"ExecutionContract",(function(){return execution_contract_ExecutionContract})),r.d(t,"ExpressionsService",(function(){return expressions_services_ExpressionsService})),r.d(t,"createError",(function(){return Le})),r.d(t,"getByAlias",(function(){return Pe})),r.d(t,"TablesAdapter",(function(){return tables_adapter_TablesAdapter})),r.d(t,"ExpressionsInspectorAdapter",(function(){return expressions_inspector_adapter_ExpressionsInspectorAdapter})),r.d(t,"createMockContext",(function(){return He})),r.d(t,"createDefaultInspectorAdapters",(function(){return De})),function(e){e.REPEAT="repeat",e.REPEAT_NO="no-repeat",e.REPEAT_X="repeat-x",e.REPEAT_Y="repeat-y",e.ROUND="round",e.SPACE="space"}(n||(n={})),function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(s||(s={})),function(e){e.ITALIC="italic",e.NORMAL="normal"}(i||(i={})),function(e){e.NORMAL="normal",e.BOLD="bold",e.BOLDER="bolder",e.LIGHTER="lighter",e.ONE="100",e.TWO="200",e.THREE="300",e.FOUR="400",e.FIVE="500",e.SIX="600",e.SEVEN="700",e.EIGHT="800",e.NINE="900"}(o||(o={})),function(e){e.AUTO="auto",e.HIDDEN="hidden",e.SCROLL="scroll",e.VISIBLE="visible"}(a||(a={})),function(e){e.CENTER="center",e.JUSTIFY="justify",e.LEFT="left",e.RIGHT="right"}(u||(u={})),function(e){e.NONE="none",e.UNDERLINE="underline"}(c||(c={}));const{toExpression:l}=r(21);function p(e,t){return l(e,t)}function d(e,t){const r=Object.entries(t).reduce(((e,[t,r])=>(Array.isArray(r)?e[t]=r.map((e=>g(e)?y(e):e)):void 0!==r?e[t]=g(r)?[y(r)]:[r]:delete e[t],e)),{...t});return{type:"expression_function_builder",name:e,arguments:r,addArgument(e,t){return void 0!==t&&(r.hasOwnProperty(e)||(r[e]=[]),r[e].push(t)),this},getArgument(e){if(r.hasOwnProperty(e))return r[e]},replaceArgument(e,t){if(!r.hasOwnProperty(e))throw new Error("Argument to replace does not exist on this function");return r[e]=t,this},removeArgument(e){return delete r[e],this},toAst:()=>({type:"function",function:e,arguments:Object.entries(r).reduce(((e,[t,r])=>(e[t]=r.map((e=>m(e)?e.toAst():e)),e)),{})}),toString(){return p({type:"expression",chain:[this.toAst()]},"expression")}}}const{parse:f}=r(21);function h(e,t){try{return f(String(e),{startRule:t})}catch(e){throw new Error(`Unable to parse expression: ${e.message}`)}}function m(e){return"expression_builder"===(null==e?void 0:e.type)}function g(e){return"expression"===(null==e?void 0:e.type)}const v=e=>({type:"expression",chain:e.map((e=>e.toAst()))});function y(e){const t=e=>e.map((e=>d(e.function,e.arguments))),r=e?"string"==typeof(n=e)?t(h(n,"expression").chain):Array.isArray(n)?n:t(n.chain):[];var n;return{type:"expression_builder",functions:r,findFunction:e=>r.reduce(((t,r)=>(Object.values(r.arguments).forEach((r=>{r.forEach((r=>{m(r)&&(t=t.concat(r.findFunction(e)))}))})),r.name===e&&t.push(r),t)),[]),toAst(){if(r.length<1)throw new Error("Functions have not been added to the expression builder");return v(r)},toString(){if(r.length<1)throw new Error("Functions have not been added to the expression builder");return p(v(r),"expression")}}}function x(e){return p(e,"expression")}function b(e){return h(e,"expression")}var A=r(8);function w(e){if(null==e)return"null";if(Array.isArray(e))throw new Error("Unexpected array value encountered.");if("object"!=typeof e)return typeof e;const{type:t}=e;if(!t)throw new Error("Objects must have a type property");return t}const E=e=>e,_=e=>({serialize:t=>(e[w(t)].serialize||E)(t),deserialize:t=>(e[w(t)].deserialize||E)(t)});var j=r(0),C=r.n(j);class expression_type_ExpressionType{constructor(e){C()(this,"name",void 0),C()(this,"help",void 0),C()(this,"validate",void 0),C()(this,"create",void 0),C()(this,"serialize",void 0),C()(this,"deserialize",void 0),C()(this,"definition",void 0),C()(this,"getToFn",(e=>this.definition.to?this.definition.to[e]||this.definition.to["*"]:void 0)),C()(this,"getFromFn",(e=>this.definition.from?this.definition.from[e]||this.definition.from["*"]:void 0)),C()(this,"castsTo",(e=>"function"==typeof this.getToFn(e))),C()(this,"castsFrom",(e=>"function"==typeof this.getFromFn(e))),C()(this,"to",((e,t,r)=>{const n=w(e);if(n!==this.name)throw new Error(`Can not cast object of type '${n}' using '${this.name}'`);if(!this.castsTo(t))throw new Error(`Can not cast '${n}' to '${t}'`);return this.getToFn(t)(e,r)})),C()(this,"from",((e,t)=>{const r=w(e);if(!this.castsFrom(r))throw new Error(`Can not cast '${this.name}' from ${r}`);return this.getFromFn(r)(e,t)}));const{name:t,help:r,deserialize:n,serialize:s,validate:i}=e;this.name=t,this.help=r||"",this.validate=i||(()=>{}),this.create=e.create,this.serialize=s,this.deserialize=n,this.definition=e}}const O="boolean",T={name:O,from:{null:()=>!1,number:e=>Boolean(e),string:e=>Boolean(e)},to:{render:e=>({type:"render",as:"text",value:{text:`${e}`}}),datatable:e=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:O}}],rows:[{value:e}]})}};var M=r(3);const S="datatable",R=e=>"datatable"===(null==e?void 0:e.type),F={name:S,validate:e=>{if(!e.columns)throw new Error("datatable must have a columns array, even if it is empty");if(!e.rows)throw new Error("datatable must have a rows array, even if it is empty")},serialize:e=>{const{columns:t,rows:r}=e;return{...e,rows:r.map((e=>t.map((t=>e[t.name]))))}},deserialize:e=>{const{columns:t,rows:r}=e;return{...e,rows:r.map((e=>Object(M.zipObject)(Object(M.map)(t,"name"),e)))}},from:{null:()=>({type:S,meta:{},rows:[],columns:[]}),pointseries:e=>({type:S,meta:{},rows:e.rows,columns:Object(M.map)(e.columns,((e,t)=>({id:t,name:t,meta:{type:e.type}})))})},to:{render:e=>({type:"render",as:"table",value:{datatable:e,paginate:!0,perPage:10,showHeader:!0}}),pointseries:e=>{const t=["x","y","color","size","text"],r=e.columns.filter((e=>t.includes(e.id))),n=e.rows.map((e=>Object(M.pick)(e,t)));return{type:"pointseries",columns:r.reduce(((e,t)=>(e[t.name]={type:t.meta.type,expression:t.name,role:"dimension"},e)),{}),rows:n}}}},N="error",k=e=>"error"===w(e),I={name:N,to:{render:e=>({type:"render",as:N,value:{error:e.error,info:e.info}})}},L={name:"filter",from:{null:()=>({type:"filter",filterType:"filter",meta:{},and:[]})}},P={name:"image",to:{render:e=>({type:"render",as:"image",value:e})}},$={name:"null",from:{"*":()=>null}};var H=r(1);const q={name:"num",from:{null:()=>({type:"num",value:0}),boolean:e=>({type:"num",value:Number(e)}),string:e=>{const t=Number(e);if(Number.isNaN(t))throw new Error(H.i18n.translate("expressions.types.number.fromStringConversionErrorMessage",{defaultMessage:'Can\'t typecast "{string}" string to number',values:{string:e}}));return{type:"num",value:t}},"*":e=>({type:"num",value:Number(e)})},to:{render:({value:e})=>({type:"render",as:"text",value:{text:`${e}`}}),datatable:({value:e})=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:"number"}}],rows:[{value:e}]})}},D={name:"number",from:{null:()=>0,boolean:e=>Number(e),string:e=>{const t=Number(e);if(Number.isNaN(t))throw new Error(H.i18n.translate("expressions.types.number.fromStringConversionErrorMessage",{defaultMessage:'Can\'t typecast "{string}" string to number',values:{string:e}}));return t}},to:{render:e=>({type:"render",as:"text",value:{text:`${e}`}}),datatable:e=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:"number"}}],rows:[{value:e}]})}},z="pointseries",B={name:z,from:{null:()=>({type:z,rows:[],columns:{}})},to:{render:(e,t)=>({type:"render",as:"table",value:{datatable:t.datatable.from(e,t),showHeader:!0}})}},U={name:"range",from:{null:()=>({type:"range",from:0,to:0})},to:{render:e=>({type:"render",as:"text",value:{text:(null==e?void 0:e.label)||`from ${e.from} to ${e.to}`}})}},G="render",V={name:G,from:{"*":e=>({type:G,as:"debug",value:e})}},W={name:"shape",to:{render:e=>({type:"render",as:"shape",value:e})}},Y={name:"string",from:{null:()=>"",boolean:e=>String(e),number:e=>String(e)},to:{render:e=>({type:"render",as:"text",value:{text:e}}),datatable:e=>({type:"datatable",columns:[{id:"value",name:"value",meta:{type:"string"}}],rows:[{value:e}]})}},J={name:"style",from:{null:()=>({type:"style",spec:{},css:""})}};function Z(e){return null==e?"null":Array.isArray(e)?e.length?Z(e[0]):"unknown":["boolean","number","object","string"].includes(typeof e)?typeof e:"unknown"}const K={name:"ui_setting",to:{boolean:({value:e})=>Boolean(e),number:({value:e})=>Number(e),string:({value:e})=>String(null!=e?e:""),render:({value:e})=>({type:"render",as:"text",value:{text:"object"==typeof e&&null!==e?JSON.stringify(e):String(null!=e?e:"")}}),datatable:({key:e,value:t})=>({type:"datatable",columns:[{id:e,name:e,meta:{type:Z(t)}}],rows:(Array.isArray(t)?t:[t]).map((t=>({[e]:t})))})}},X=[T,F,I,L,P,$,q,D,B,U,V,W,Y,J,K];function Q({type:e,...t}){return t}class expression_function_parameter_ExpressionFunctionParameter{constructor(e,t){C()(this,"name",void 0),C()(this,"required",void 0),C()(this,"help",void 0),C()(this,"types",void 0),C()(this,"default",void 0),C()(this,"aliases",void 0),C()(this,"multi",void 0),C()(this,"resolve",void 0),C()(this,"options",void 0);const{required:r,help:n,types:s,aliases:i,multi:o,resolve:a,options:u}=t;if("_"===e)throw Error("Arg names must not be _. Use it in aliases instead.");this.name=e,this.required=!!r,this.help=n||"",this.types=s||[],this.default=t.default,this.aliases=i||[],this.multi=!!o,this.resolve=null==a||a,this.options=u||[]}accepts(e){var t;return!(null!==(t=this.types)&&void 0!==t&&t.length)||this.types.includes(e)}}class expression_function_ExpressionFunction{constructor(e){C()(this,"name",void 0),C()(this,"aliases",void 0),C()(this,"type",void 0),C()(this,"fn",void 0),C()(this,"help",void 0),C()(this,"args",{}),C()(this,"inputTypes",void 0),C()(this,"disabled",void 0),C()(this,"telemetry",void 0),C()(this,"extract",void 0),C()(this,"inject",void 0),C()(this,"migrations",void 0),C()(this,"accepts",(e=>{var t,r;return null===(t=null===(r=this.inputTypes)||void 0===r?void 0:r.includes(e))||void 0===t||t}));const{name:t,type:r,aliases:n,fn:s,help:i,args:o,inputTypes:a,context:u,disabled:c,telemetry:l,inject:p,extract:d,migrations:f}=e;this.name=t,this.type=r,this.aliases=n||[],this.fn=s,this.help=i||"",this.inputTypes=a||(null==u?void 0:u.types),this.disabled=c||!1,this.telemetry=l||((e,t)=>t),this.inject=p||M.identity,this.extract=d||(e=>({state:e,references:[]})),this.migrations=f||{};for(const[e,t]of Object.entries(o||{}))this.args[e]=new expression_function_parameter_ExpressionFunctionParameter(e,t)}}const ee={name:"clog",args:{},help:"Outputs the context to the console",fn:e=>(console.log(e),e)},te={name:"createTable",type:"datatable",inputTypes:["null"],help:H.i18n.translate("expressions.functions.createTableHelpText",{defaultMessage:"Creates a datatable with a list of columns, and 1 or more empty rows. To populate the rows, use {mapColumnFn} or {mathColumnFn}.",values:{mathColumnFn:"`mathColumn`",mapColumnFn:"`mapColumn`"}}),args:{ids:{types:["string"],help:H.i18n.translate("expressions.functions.createTable.args.idsHelpText",{defaultMessage:"Column ids to generate in positional order. ID represents the key in the row."}),required:!1,multi:!0},names:{types:["string"],help:H.i18n.translate("expressions.functions.createTable.args.nameHelpText",{defaultMessage:"Column names to generate in positional order. Names are not required to be unique, and default to the ID if not provided."}),required:!1,multi:!0},rowCount:{types:["number"],help:H.i18n.translate("expressions.functions.createTable.args.rowCountText",{defaultMessage:"The number of empty rows to add to the table, to be assigned a value later"}),default:1,required:!1}},fn(e,t){var r;const n=[];return(null!==(r=t.ids)&&void 0!==r?r:[]).map(((e,r)=>{var s,i;n.push({id:e,name:null!==(s=null===(i=t.names)||void 0===i?void 0:i[r])&&void 0!==s?s:e,meta:{type:"null"}})})),{columns:n,rows:[...Array(t.rowCount)].map((()=>({}))),type:"datatable"}}},re=e=>{if(!e)return"";return Object.keys(e).map((t=>t.trim().replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\W/g,(e=>/[À-ž]/.test(e)?e:"-")).replace(/^-+|-+$/g,"").toLowerCase().concat(":").concat(String(e[t])))).join(";")},ne={name:"font",aliases:[],type:"style",help:H.i18n.translate("expressions.functions.fontHelpText",{defaultMessage:"Create a font style."}),inputTypes:["null"],args:{align:{default:'{ theme "font.align" default="left" }',help:H.i18n.translate("expressions.functions.font.args.alignHelpText",{defaultMessage:"The horizontal text alignment."}),options:Object.values(u),types:["string"]},color:{default:'{ theme "font.color" }',help:H.i18n.translate("expressions.functions.font.args.colorHelpText",{defaultMessage:"The text color."}),types:["string"]},family:{default:`{ theme "font.family" default="${A.openSans.value}" }`,help:H.i18n.translate("expressions.functions.font.args.familyHelpText",{defaultMessage:"An acceptable {css} web font string",values:{css:"CSS"}}),types:["string"]},italic:{default:'{ theme "font.italic" default=false }',help:H.i18n.translate("expressions.functions.font.args.italicHelpText",{defaultMessage:"Italicize the text?"}),options:[!0,!1],types:["boolean"]},lHeight:{default:'{ theme "font.lHeight" }',aliases:["lineHeight"],help:H.i18n.translate("expressions.functions.font.args.lHeightHelpText",{defaultMessage:"The line height in pixels"}),types:["number","null"]},size:{default:'{ theme "font.size" default=14 }',help:H.i18n.translate("expressions.functions.font.args.sizeHelpText",{defaultMessage:"The font size in pixels"}),types:["number"]},underline:{default:'{ theme "font.underline" default=false }',help:H.i18n.translate("expressions.functions.font.args.underlineHelpText",{defaultMessage:"Underline the text?"}),options:[!0,!1],types:["boolean"]},weight:{default:'{ theme "font.weight" default="normal" }',help:H.i18n.translate("expressions.functions.font.args.weightHelpText",{defaultMessage:"The font weight. For example, {list}, or {end}.",values:{list:Object.values(o).slice(0,-1).map((e=>`\`"${e}"\``)).join(", "),end:`\`"${Object.values(o).slice(-1)[0]}"\``}}),options:Object.values(o),types:["string"]}},fn:(e,t)=>{if(!Object.values(o).includes(t.weight))throw new Error(H.i18n.translate("expressions.functions.font.invalidFontWeightErrorMessage",{defaultMessage:"Invalid font weight: '{weight}'",values:{weight:t.weight}}));if(!Object.values(u).includes(t.align))throw new Error(H.i18n.translate("expressions.functions.font.invalidTextAlignmentErrorMessage",{defaultMessage:"Invalid text alignment: '{align}'",values:{align:t.align}}));const r=null!=t.lHeight?`${t.lHeight}px`:"1",n={fontFamily:t.family,fontWeight:t.weight,fontStyle:t.italic?i.ITALIC:i.NORMAL,textDecoration:t.underline?c.UNDERLINE:c.NONE,textAlign:t.align,fontSize:`${t.size}px`,lineHeight:r};return t.color&&(n.color=t.color),{type:"style",spec:n,css:re(n)}}},se={name:"var_set",help:H.i18n.translate("expressions.functions.varset.help",{defaultMessage:"Updates the Kibana global context."}),args:{name:{types:["string"],aliases:["_"],required:!0,multi:!0,help:H.i18n.translate("expressions.functions.varset.name.help",{defaultMessage:"Specify the name of the variable."})},value:{aliases:["val"],multi:!0,help:H.i18n.translate("expressions.functions.varset.val.help",{defaultMessage:"Specify the value for the variable. When unspecified, the input context is used."})}},fn(e,t,r){const{variables:n}=r;return t.name.forEach(((r,s)=>{n[r]=void 0===t.value[s]?e:t.value[s]})),e}},ie={name:"var",help:H.i18n.translate("expressions.functions.var.help",{defaultMessage:"Updates the Kibana global context."}),args:{name:{types:["string"],aliases:["_"],required:!0,help:H.i18n.translate("expressions.functions.var.name.help",{defaultMessage:"Specify the name of the variable."})}},fn(e,t,r){const{variables:n}=r;return n[t.name]}},oe={name:"theme",aliases:[],help:H.i18n.translate("expressions.functions.themeHelpText",{defaultMessage:"Reads a theme setting."}),inputTypes:["null"],args:{variable:{aliases:["_"],help:H.i18n.translate("expressions.functions.theme.args.variableHelpText",{defaultMessage:"Name of the theme variable to read."}),required:!0,types:["string"]},default:{help:H.i18n.translate("expressions.functions.theme.args.defaultHelpText",{defaultMessage:"default value in case theming info is not available."})}},fn:(e,t,r)=>{const n=r.variables.theme||{};return Object(M.get)(n,t.variable,t.default)}};function ae(e,t){return(t||[]).map((t=>null==e[t]?"":String(e[t]))).join("|")}function ue(e,t,r,n,s={allowColumnOverwrite:!1}){if(!s.allowColumnOverwrite&&e.columns.some((e=>e.id===t)))throw new Error(H.i18n.translate("expressions.functions.seriesCalculations.columnConflictMessage",{defaultMessage:"Specified outputColumnId {columnId} already exists. Please pick another column id.",values:{columnId:t}}));const i=e.columns.find((e=>e.id===r));if(!i)return;const o={...i,id:t,name:n||t},a=[...e.columns];return a.splice(a.indexOf(i)+1,0,o),a}const ce={name:"cumulative_sum",type:"datatable",inputTypes:["datatable"],help:H.i18n.translate("expressions.functions.cumulativeSum.help",{defaultMessage:"Calculates the cumulative sum of a column in a data table"}),args:{by:{help:H.i18n.translate("expressions.functions.cumulativeSum.args.byHelpText",{defaultMessage:"Column to split the cumulative sum calculation by"}),multi:!0,types:["string"],required:!1},inputColumnId:{help:H.i18n.translate("expressions.functions.cumulativeSum.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the cumulative sum of"}),types:["string"],required:!0},outputColumnId:{help:H.i18n.translate("expressions.functions.cumulativeSum.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting cumulative sum in"}),types:["string"],required:!0},outputColumnName:{help:H.i18n.translate("expressions.functions.cumulativeSum.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting cumulative sum in"}),types:["string"],required:!1}},fn(e,{by:t,inputColumnId:r,outputColumnId:n,outputColumnName:s}){const i=ue(e,n,r,s);if(!i)return e;const o={};return{...e,columns:i,rows:e.rows.map((e=>{var s;const i={...e},a=ae(e,t),u=null!==(s=o[a])&&void 0!==s?s:0,c=i[r];return null!=c?(i[n]=Number(c)+u,o[a]=i[n]):i[n]=u,i}))}}};const le={name:"overall_metric",type:"datatable",inputTypes:["datatable"],help:H.i18n.translate("expressions.functions.overallMetric.help",{defaultMessage:"Calculates the overall sum, min, max or average of a column in a data table"}),args:{by:{help:H.i18n.translate("expressions.functions.overallMetric.args.byHelpText",{defaultMessage:"Column to split the overall calculation by"}),multi:!0,types:["string"],required:!1},metric:{help:H.i18n.translate("expressions.functions.overallMetric.metricHelpText",{defaultMessage:"Metric to calculate"}),types:["string"],options:["sum","min","max","average"]},inputColumnId:{help:H.i18n.translate("expressions.functions.overallMetric.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the overall metric of"}),types:["string"],required:!0},outputColumnId:{help:H.i18n.translate("expressions.functions.overallMetric.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting overall metric in"}),types:["string"],required:!0},outputColumnName:{help:H.i18n.translate("expressions.functions.overallMetric.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting overall metric in"}),types:["string"],required:!1}},fn(e,{by:t,inputColumnId:r,outputColumnId:n,outputColumnName:s,metric:i}){const o=ue(e,n,r,s);if(!o)return e;const a={},u={};return e.rows.forEach((e=>{var n;const s=ae(e,t),o=a[s],c=e[r];if(null!=c){const e=(l=c,Array.isArray(l)?l.map((e=>Number(e))):[Number(l)]);switch(i){case"average":u[s]=(null!==(n=u[s])&&void 0!==n?n:0)+e.length;case"sum":a[s]=e.reduce(((e,t)=>e+t),o||0);break;case"min":a[s]=void 0!==o?Math.min(o,...e):Math.min(...e);break;case"max":a[s]=void 0!==o?Math.max(o,...e):Math.max(...e)}}var l})),"average"===i&&Object.keys(a).forEach((e=>{const t=a[e],r=u[e];void 0!==t&&void 0!==r&&(a[e]=t/r)})),{...e,columns:o,rows:e.rows.map((e=>{const r={...e},s=ae(e,t);return r[n]=a[s],r}))}}},pe={name:"derivative",type:"datatable",inputTypes:["datatable"],help:H.i18n.translate("expressions.functions.derivative.help",{defaultMessage:"Calculates the derivative of a column in a data table"}),args:{by:{help:H.i18n.translate("expressions.functions.derivative.args.byHelpText",{defaultMessage:"Column to split the derivative calculation by"}),multi:!0,types:["string"],required:!1},inputColumnId:{help:H.i18n.translate("expressions.functions.derivative.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the derivative of"}),types:["string"],required:!0},outputColumnId:{help:H.i18n.translate("expressions.functions.derivative.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting derivative in"}),types:["string"],required:!0},outputColumnName:{help:H.i18n.translate("expressions.functions.derivative.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting derivative in"}),types:["string"],required:!1}},fn(e,{by:t,inputColumnId:r,outputColumnId:n,outputColumnName:s}){const i=ue(e,n,r,s);if(!i)return e;const o={};return{...e,columns:i,rows:e.rows.map((e=>{const s={...e},i=ae(e,t),a=o[i],u=s[r];return s[n]=null!=u&&null!=a?Number(u)-a:void 0,o[i]=null!=u?Number(u):void 0,s}))}}},de={name:"moving_average",type:"datatable",inputTypes:["datatable"],help:H.i18n.translate("expressions.functions.movingAverage.help",{defaultMessage:"Calculates the moving average of a column in a data table"}),args:{by:{help:H.i18n.translate("expressions.functions.movingAverage.args.byHelpText",{defaultMessage:"Column to split the moving average calculation by"}),multi:!0,types:["string"],required:!1},inputColumnId:{help:H.i18n.translate("expressions.functions.movingAverage.args.inputColumnIdHelpText",{defaultMessage:"Column to calculate the moving average of"}),types:["string"],required:!0},outputColumnId:{help:H.i18n.translate("expressions.functions.movingAverage.args.outputColumnIdHelpText",{defaultMessage:"Column to store the resulting moving average in"}),types:["string"],required:!0},outputColumnName:{help:H.i18n.translate("expressions.functions.movingAverage.args.outputColumnNameHelpText",{defaultMessage:"Name of the column to store the resulting moving average in"}),types:["string"],required:!1},window:{help:H.i18n.translate("expressions.functions.movingAverage.args.windowHelpText",{defaultMessage:'The size of window to "slide" across the histogram.'}),types:["number"],default:5}},fn(e,{by:t,inputColumnId:r,outputColumnId:n,outputColumnName:s,window:i}){const o=ue(e,n,r,s);if(!o)return e;const a={};return{...e,columns:o,rows:e.rows.map((e=>{const s={...e},o=ae(e,t),u=a[o],c=s[r];if(null!=u&&null!=c){const e=u.reduce(((e,t)=>e+t),0);s[n]=e/u.length}else s[n]=void 0;return null!=c&&(a[o]=[...u||[],Number(c)].slice(-i)),s}))}}};function fe({getStartDependencies:e}){return{name:"uiSetting",help:H.i18n.translate("expressions.functions.uiSetting.help",{defaultMessage:"Returns a UI settings parameter value."}),args:{default:{help:H.i18n.translate("expressions.functions.uiSetting.args.default",{defaultMessage:"A default value in case of the parameter is not set."})},parameter:{aliases:["_"],help:H.i18n.translate("expressions.functions.uiSetting.args.parameter",{defaultMessage:"The parameter name."}),required:!0,types:["string"]}},async fn(t,{default:r,parameter:n},{getKibanaRequest:s}){const{uiSettings:i}=await e((()=>{const e=null==s?void 0:s();if(!e)throw new Error(H.i18n.translate("expressions.functions.uiSetting.error.kibanaRequest",{defaultMessage:"A KibanaRequest is required to get UI settings on the server. Please provide a request object to the expression execution params."}));return e}));try{return{type:"ui_setting",key:n,value:await i.get(n,r)}}catch{throw new Error(H.i18n.translate("expressions.functions.uiSetting.error.parameter",{defaultMessage:'Invalid parameter "{parameter}".',values:{parameter:n}}))}}}}var he=r(2),me=r(4);const ge={name:"mapColumn",aliases:["mc"],type:"datatable",inputTypes:["datatable"],help:H.i18n.translate("expressions.functions.mapColumnHelpText",{defaultMessage:"Adds a column calculated as the result of other columns. Changes are made only when you provide arguments.See also {alterColumnFn} and {staticColumnFn}.",values:{alterColumnFn:"`alterColumn`",staticColumnFn:"`staticColumn`"}}),args:{id:{types:["string","null"],help:H.i18n.translate("expressions.functions.mapColumn.args.idHelpText",{defaultMessage:"An optional id of the resulting column. When no id is provided, the id will be looked up from the existing column by the provided name argument. If no column with this name exists yet, a new column with this name and an identical id will be added to the table."}),required:!1,default:null},name:{types:["string"],aliases:["_","column"],help:H.i18n.translate("expressions.functions.mapColumn.args.nameHelpText",{defaultMessage:"The name of the resulting column. Names are not required to be unique."}),required:!0},expression:{types:["boolean","number","string","null"],resolve:!1,aliases:["exp","fn","function"],help:H.i18n.translate("expressions.functions.mapColumn.args.expressionHelpText",{defaultMessage:"An expression that is executed on every row, provided with a single-row {DATATABLE} context and returning the cell value.",values:{DATATABLE:"`datatable`"}}),required:!0},copyMetaFrom:{types:["string","null"],help:H.i18n.translate("expressions.functions.mapColumn.args.copyMetaFromHelpText",{defaultMessage:"If set, the meta object from the specified column id is copied over to the specified target column. If the column doesn't exist it silently fails."}),required:!1,default:null}},fn(e,t){var r,n,s;const i=t.copyMetaFrom?e.columns.find((({id:e})=>e===t.copyMetaFrom)):void 0,o=e.columns.findIndex((({id:e,name:r})=>t.id?e===t.id:r===t.name)),a=-1===o?e.columns.length:o,u=null!==(r=null!==(n=null===(s=e.columns[a])||void 0===s?void 0:s.id)&&void 0!==n?n:t.id)&&void 0!==r?r:t.name;return Object(he.defer)((()=>Object(he.combineLatest)(e.rows.map((r=>t.expression({type:"datatable",columns:[...e.columns],rows:[r]}).pipe(Object(me.map)((e=>({...r,[u]:e}))),Object(me.defaultIfEmpty)(r))))))).pipe(Object(me.defaultIfEmpty)([]),Object(me.map)((r=>{var n;let s="null";for(const e of r){const t=w(e[u]);if("null"!==t){s=t;break}}const o=[...e.columns];return o[a]={id:u,name:t.name,meta:{type:s,params:{id:s},...null!==(n=null==i?void 0:i.meta)&&void 0!==n?n:{}}},{columns:o,rows:r,type:"datatable"}})))}};var ve=r(30);const ye="`TinyMath`";const xe=()=>new Error(H.i18n.translate("expressions.functions.math.emptyExpressionErrorMessage",{defaultMessage:"Empty expression"})),be=()=>new Error(H.i18n.translate("expressions.functions.math.tooManyResultsErrorMessage",{defaultMessage:"Expressions must return a single number. Try wrapping your expression in {mean} or {sum}",values:{mean:"mean()",sum:"sum()"}})),Ae=()=>new Error(H.i18n.translate("expressions.functions.math.executionFailedErrorMessage",{defaultMessage:"Failed to execute math expression. Check your column names"})),we=()=>new Error(H.i18n.translate("expressions.functions.math.emptyDatatableErrorMessage",{defaultMessage:"Empty datatable"})),Ee={null:null,zero:0,false:!1},_e={name:"math",type:void 0,inputTypes:["number","datatable"],help:H.i18n.translate("expressions.functions.mathHelpText",{defaultMessage:"Interprets a {TINYMATH} math expression using a {TYPE_NUMBER} or {DATATABLE} as {CONTEXT}. The {DATATABLE} columns are available by their column name. If the {CONTEXT} is a number it is available as {value}.",values:{TINYMATH:ye,CONTEXT:"_context_",DATATABLE:"`datatable`",value:"`value`",TYPE_NUMBER:"`number`"}}),args:{expression:{aliases:["_"],types:["string"],help:H.i18n.translate("expressions.functions.math.args.expressionHelpText",{defaultMessage:"An evaluated {TINYMATH} expression. See {TINYMATH_URL}.",values:{TINYMATH:ye,TINYMATH_URL:"https://www.elastic.co/guide/en/kibana/current/canvas-tinymath-functions.html"}})},onError:{types:["string"],options:["throw","false","zero","null"],help:H.i18n.translate("expressions.functions.math.args.onErrorHelpText",{defaultMessage:"In case the {TINYMATH} evaluation fails or returns NaN, the return value is specified by onError. When `'throw'`, it will throw an exception, terminating expression execution (default).",values:{TINYMATH:ye}})}},fn:(e,t)=>{const{expression:r,onError:n}=t,s=null!=n?n:"throw";if(!r||""===r.trim())throw xe();const i=R(e)?function(e,t){const r=t||Object.keys(e[0]);if(!r.every(M.isString))throw new Error("Columns should be an array of strings");const n=Object(M.map)(r,(t=>Object(M.map)(e,t)));return Object(M.zipObject)(r,n)}(e.rows,e.columns.map((e=>e.id))):{value:e};try{const e=Object(ve.evaluate)(r,i);if(Array.isArray(e)){if(1===e.length)return e[0];throw be()}if(isNaN(e)){if("throw"!==s&&s in Ee)return Ee[s];throw Ae()}return e}catch(t){if("throw"!==s&&s in Ee)return Ee[s];throw R(e)&&0===e.rows.length?we():t}}},je={name:"mathColumn",type:"datatable",inputTypes:["datatable"],help:H.i18n.translate("expressions.functions.mathColumnHelpText",{defaultMessage:"Adds a column calculated as the result of other columns. Changes are made only when you provide arguments.See also {alterColumnFn} and {staticColumnFn}.",values:{alterColumnFn:"`alterColumn`",staticColumnFn:"`staticColumn`"}}),args:{..._e.args,id:{types:["string"],help:H.i18n.translate("expressions.functions.mathColumn.args.idHelpText",{defaultMessage:"id of the resulting column. Must be unique."}),required:!0},name:{types:["string"],aliases:["_","column"],help:H.i18n.translate("expressions.functions.mathColumn.args.nameHelpText",{defaultMessage:"The name of the resulting column. Names are not required to be unique."}),required:!0},copyMetaFrom:{types:["string","null"],help:H.i18n.translate("expressions.functions.mathColumn.args.copyMetaFromHelpText",{defaultMessage:"If set, the meta object from the specified column id is copied over to the specified target column. If the column doesn't exist it silently fails."}),required:!1,default:null}},fn:(e,t,r)=>{var n;const s=[...e.columns];if(s.findIndex((({id:e})=>e===t.id))>-1)throw new Error(H.i18n.translate("expressions.functions.mathColumn.uniqueIdError",{defaultMessage:"ID must be unique"}));const i=e.rows.map((n=>{const s=_e.fn({type:"datatable",columns:e.columns,rows:[n]},{expression:t.expression,onError:t.onError},r);if(Array.isArray(s)){if(1===s.length)return{...n,[t.id]:s[0]};throw new Error(H.i18n.translate("expressions.functions.mathColumn.arrayValueError",{defaultMessage:"Cannot perform math on array values at {name}",values:{name:t.name}}))}return{...n,[t.id]:s}}));let o="null";if(i.length)for(const e of i){const r=w(e[t.id]);if("null"!==r){o=r;break}}const a={id:t.id,name:null!==(n=t.name)&&void 0!==n?n:t.id,meta:{type:o,params:{id:o}}};if(t.copyMetaFrom){const e=s.find((({id:e})=>e===t.copyMetaFrom));a.meta={...a.meta,...(null==e?void 0:e.meta)||{}}}return s.push(a),{type:"datatable",columns:s,rows:i}}};class expression_renderer_ExpressionRenderer{constructor(e){C()(this,"name",void 0),C()(this,"displayName",void 0),C()(this,"help",void 0),C()(this,"validate",void 0),C()(this,"reuseDomNode",void 0),C()(this,"render",void 0);const{name:t,displayName:r,help:n,validate:s,reuseDomNode:i,render:o}=e;this.name=t,this.displayName=r||t,this.help=n||"",this.validate=s||(()=>{}),this.reuseDomNode=Boolean(i),this.render=o}}class expression_renderer_registry_ExpressionRendererRegistry{constructor(){C()(this,"renderers",new Map)}register(e){"function"==typeof e&&(e=e());const t=new expression_renderer_ExpressionRenderer(e);this.renderers.set(t.name,t)}get(e){return this.renderers.get(e)||null}toJS(){return this.toArray().reduce(((e,t)=>({...e,[t.name]:t})),{})}toArray(){return[...this.renderers.values()]}}var Ce=r(12);const Oe={functions:{},types:{},context:{}},Te={addFunction:e=>t=>({...e,functions:{...e.functions,[t.name]:t}}),addType:e=>t=>({...e,types:{...e.types,[t.name]:t}}),extendContext:e=>t=>({...e,context:{...e.context,...t}})},Me={getFunction:e=>t=>e.functions[t]||null,getType:e=>t=>e.types[t]||null,getContext:({context:e})=>()=>e},Se=(e=Oe)=>Object(Ce.createStateContainer)(e,Te,Me);var Re=r(18);const Fe={...Oe,state:"not-started",ast:{type:"expression",chain:[]}},Ne={start:e=>()=>({...e,state:"pending"}),setResult:e=>t=>({...e,state:"result",result:t}),setError:e=>t=>({...e,state:"error",error:t})},ke=e=>e,Ie=(e=Fe)=>Object(Ce.createStateContainer)(e,Ne,{},{freeze:ke}),Le=e=>({type:"error",error:{stack:void 0,message:"string"==typeof e?e:String(e.message),name:"object"==typeof e&&e.name||"Error",original:e instanceof Error?e:"object"==typeof e&&"original"in e&&e.original instanceof Error?e.original:void 0}});function Pe(e,t){const r=t.toLowerCase();return Object.values(e).find((({name:e,aliases:t})=>!!e&&(e.toLowerCase()===r||(t||[]).some((e=>e.toLowerCase()===r)))))}var $e=r(13);class tables_adapter_TablesAdapter extends $e.EventEmitter{constructor(...e){super(...e),C()(this,"_tables",{})}logDatatable(e,t){this._tables[e]=t,this.emit("change",this.tables)}get tables(){return this._tables}}class expressions_inspector_adapter_ExpressionsInspectorAdapter extends $e.EventEmitter{constructor(...e){super(...e),C()(this,"_ast",{})}logAST(e){this._ast=e,this.emit("change",this._ast)}get ast(){return this._ast}}const He=()=>({getSearchContext:()=>({}),getSearchSessionId:()=>{},types:{},variables:{},abortSignal:{},inspectorAdapters:{}});var qe=r(31);const De=()=>({requests:new qe.RequestAdapter,tables:new tables_adapter_TablesAdapter,expression:new expressions_inspector_adapter_ExpressionsInspectorAdapter});var ze=r(7);class execution_contract_ExecutionContract{get isPending(){const e=this.execution.state.get().state;return!("error"===e||"result"===e)}constructor(e){C()(this,"execution",void 0),C()(this,"cancel",(()=>{this.execution.cancel()})),C()(this,"getData",(()=>this.execution.result.pipe(Object(me.catchError)((({name:e,message:t,stack:r})=>Object(he.of)({partial:!1,result:{type:"error",error:{name:e,message:t,stack:r}}})))))),C()(this,"getExpression",(()=>this.execution.expression)),C()(this,"getAst",(()=>this.execution.state.get().ast)),C()(this,"inspect",(()=>this.execution.inspectorAdapters)),this.execution=e}}class execution_Execution{get inspectorAdapters(){return this.context.inspectorAdapters}constructor(e){C()(this,"state",void 0),C()(this,"input",null),C()(this,"input$",new he.ReplaySubject(1)),C()(this,"context",void 0),C()(this,"abortController",new AbortController),C()(this,"hasStarted",!1),C()(this,"result",void 0),C()(this,"childExecutions",[]),C()(this,"contract",void 0),C()(this,"expression",void 0),this.execution=e;const{executor:t}=e;if(this.contract=new execution_contract_ExecutionContract(this),!e.ast&&!e.expression)throw new TypeError("Execution params should contain at least .ast or .expression key.");if(e.ast&&e.expression)throw new TypeError("Execution params cannot contain both .ast and .expression key.");this.expression=e.expression||x(e.ast);const r=e.ast||b(this.expression);this.state=Ie({...t.state,state:"not-started",ast:r});const n=e.params.inspectorAdapters||De();this.context={getSearchContext:()=>this.execution.params.searchContext||{},getSearchSessionId:()=>e.params.searchSessionId,getKibanaRequest:e.params.kibanaRequest?()=>e.params.kibanaRequest:void 0,variables:e.params.variables||{},types:t.getTypes(),abortSignal:this.abortController.signal,inspectorAdapters:n,logDatatable:(e,t)=>{n.tables[e]=t},isSyncColorsEnabled:()=>e.params.syncColors,...e.params.extraContext,getExecutionContext:()=>e.params.executionContext},this.result=this.input$.pipe(Object(me.switchMap)((e=>{return this.invokeChain(this.state.get().ast.chain,e).pipe((t=this.abortController.signal,e=>new he.Observable((r=>{const n=()=>{r.error(new ze.AbortError)};r.add(e.subscribe(r)),r.add((()=>t.removeEventListener("abort",n))),t.addEventListener("abort",n),t.aborted&&n()}))),(e=>new he.Observable((t=>{let r;t.add(e.subscribe({next:e=>{r={result:e,partial:!0},t.next(r)},error:e=>t.error(e),complete:()=>{r&&(r.partial=!1),t.complete()}})),t.add((()=>{r=void 0}))}))));var t})),Object(me.catchError)((e=>this.abortController.signal.aborted?(this.childExecutions.forEach((e=>e.cancel())),Object(he.of)({result:Le({message:"The expression was aborted.",name:"AbortError"}),partial:!1})):Object(he.throwError)(e))),Object(me.tap)({next:e=>{var t;null===(t=this.context.inspectorAdapters.expression)||void 0===t||t.logAST(this.state.get().ast),this.state.transitions.setResult(e)},error:e=>this.state.transitions.setError(e)}),Object(me.shareReplay)(1))}cancel(){this.abortController.abort()}start(e=null,t){if(this.hasStarted)throw new Error("Execution already started.");var r;(this.hasStarted=!0,this.input=e,this.state.transitions.start(),t)||(null===(r=this.context.inspectorAdapters.requests)||void 0===r||r.reset());return Object(he.isObservable)(e)?e.subscribe(this.input$):Object(Re.isPromise)(e)?Object(he.from)(e).subscribe(this.input$):Object(he.of)(e).subscribe(this.input$),this.result}invokeChain(e,t){return Object(he.of)(t).pipe(...e.map((e=>Object(me.switchMap)((t=>{const{function:r,arguments:n}=e,s=Pe(this.state.get().functions,r);if(!s)throw Le({name:"fn not found",message:H.i18n.translate("expressions.execution.functionNotFound",{defaultMessage:"Function {fnName} could not be found.",values:{fnName:r}})});if(s.disabled)throw Le({name:"fn is disabled",message:H.i18n.translate("expressions.execution.functionDisabled",{defaultMessage:"Function {fnName} is disabled.",values:{fnName:r}})});this.execution.params.debug&&(e.debug={args:{},duration:0,fn:s.name,input:t,success:!0});const i=this.execution.params.debug?Object(ze.now)():0;return this.resolveArgs(s,t,n).pipe(Object(me.tap)((t=>{var r;return this.execution.params.debug&&Object.assign(null!==(r=e.debug)&&void 0!==r?r:{},{args:t})})),Object(me.switchMap)((e=>this.invokeFunction(s,t,e))),Object(me.switchMap)((e=>"error"===w(e)?Object(he.throwError)(e):Object(he.of)(e))),Object(me.tap)((t=>{var r;return this.execution.params.debug&&Object.assign(null!==(r=e.debug)&&void 0!==r?r:{},{output:t})})),Object(me.catchError)((t=>{const n=Le(t);var s;(n.error.message=`[${r}] > ${n.error.message}`,this.execution.params.debug)&&Object.assign(null!==(s=e.debug)&&void 0!==s?s:{},{error:n,rawError:t,success:!1});return Object(he.throwError)(n)})),Object(me.finalize)((()=>{var t;this.execution.params.debug&&Object.assign(null!==(t=e.debug)&&void 0!==t?t:{},{duration:Object(ze.now)()-i})})))})))),Object(me.catchError)((e=>Object(he.of)(e))))}invokeFunction(e,t,r){return Object(he.of)(t).pipe(Object(me.map)((t=>this.cast(t,e.inputTypes))),Object(me.switchMap)((t=>Object(he.of)(e.fn(t,r,this.context)))),Object(me.switchMap)((e=>Object(he.isObservable)(e)?e:Object(he.from)(Object(Re.isPromise)(e)?e:[e]))),Object(me.map)((t=>{const r=w(t),n=e.type;if(n&&r!==n)throw new Error(`Function '${e.name}' should return '${n}', actually returned '${r}'`);const s=this.context.types[e.type];if(s&&s.validate)try{s.validate(t)}catch(t){throw new Error(`Output of '${e.name}' is not a valid type '${e.type}': ${t}`)}return t})))}cast(e,t){if(null==t||!t.length)return e;const r=w(e);if(t.includes(r))return e;const{types:n}=this.state.get(),s=n[r];for(const i of t){if(null!=s&&s.castsTo(i))return s.to(e,i,n);const t=n[i];if(null!=t&&t.castsFrom(r))return t.from(e,n)}throw new Error(`Can not cast '${r}' to any of '${t.join(", ")}'`)}resolveArgs(e,t,r){return Object(he.defer)((()=>{const{args:n}=e,s=Object(M.reduce)(r,((t,r,s)=>{const i=Pe(n,s);if(!i)throw new Error(`Unknown argument '${s}' passed to function '${e.name}'`);return t[i.name]=(t[i.name]||[]).concat(r),t}),{});for(const{aliases:t,default:r,name:i,required:o}of Object.values(n)){if(i in s||void 0===r||(s[i]=[h(r,"argument")]),!o||i in s)continue;if(null==t||!t.length)throw new Error(`${e.name} requires an argument`);const n="_"===i?t[0]:i;throw new Error(`${e.name} requires an "${n}" argument`)}const i=Object(M.mapValues)(s,((e,r)=>e.map((e=>(s=t)=>this.interpret(e,s).pipe(Object(me.pluck)("result"),Object(me.map)((e=>{if(k(e))throw e.error;return this.cast(e,n[r].types)}))))))),o=Object(M.keys)(i);if(!o.length)return Object(he.from)([{}]);return Object(he.combineLatest)(o.map((e=>{const t=i[e];return t.length?n[e].resolve?Object(he.combineLatest)(t.map((e=>e()))):Object(he.of)(t):Object(he.of)([])}))).pipe(Object(me.map)((e=>Object(M.mapValues)(Object(M.zipObject)(o,e),((e,t)=>n[t].multi?e:Object(M.last)(e))))))}))}interpret(e,t){switch(w(e)){case"expression":const r=this.execution.executor.createExecution(e,{...this.execution.params,variables:this.context.variables});return this.childExecutions.push(r),r.start(t,!0);case"string":case"number":case"null":case"boolean":return Object(he.of)({result:e,partial:!1});default:return Object(he.throwError)(new Error(`Unknown AST object: ${JSON.stringify(e)}`))}}}class TypesRegistry{constructor(e){this.executor=e}register(e){this.executor.registerType(e)}get(e){var t;return null!==(t=this.executor.getType(e))&&void 0!==t?t:null}toJS(){return this.executor.getTypes()}toArray(){return Object.values(this.toJS())}}class FunctionsRegistry{constructor(e){this.executor=e}register(e){this.executor.registerFunction(e)}get(e){var t;return null!==(t=this.executor.getFunction(e))&&void 0!==t?t:null}toJS(){return this.executor.getFunctions()}toArray(){return Object.values(this.toJS())}}class executor_Executor{static createWithDefaults(e){const t=new executor_Executor(e);for(const e of X)t.registerType(e);return t}constructor(e){C()(this,"container",void 0),C()(this,"functions",void 0),C()(this,"types",void 0),C()(this,"parent",void 0),this.functions=new FunctionsRegistry(this),this.types=new TypesRegistry(this),this.container=Se(e)}get state(){var e,t,r,n;const s=null===(e=this.parent)||void 0===e?void 0:e.state,i=this.container.get();return{...null!=s?s:{},...i,types:{...null!==(t=null==s?void 0:s.types)&&void 0!==t?t:{},...i.types},functions:{...null!==(r=null==s?void 0:s.functions)&&void 0!==r?r:{},...i.functions},context:{...null!==(n=null==s?void 0:s.context)&&void 0!==n?n:{},...i.context}}}registerFunction(e){const t=new expression_function_ExpressionFunction("object"==typeof e?e:e());this.container.transitions.addFunction(t)}getFunction(e){var t,r;return null!==(t=this.container.get().functions[e])&&void 0!==t?t:null===(r=this.parent)||void 0===r?void 0:r.getFunction(e)}getFunctions(){var e,t;return{...null!==(e=null===(t=this.parent)||void 0===t?void 0:t.getFunctions())&&void 0!==e?e:{},...this.container.get().functions}}registerType(e){const t=new expression_type_ExpressionType("object"==typeof e?e:e());this.container.transitions.addType(t)}getType(e){var t,r;return null!==(t=this.container.get().types[e])&&void 0!==t?t:null===(r=this.parent)||void 0===r?void 0:r.getType(e)}getTypes(){var e,t;return{...null!==(e=null===(t=this.parent)||void 0===t?void 0:t.getTypes())&&void 0!==e?e:{},...this.container.get().types}}extendContext(e){this.container.transitions.extendContext(e)}get context(){var e,t;return{...null!==(e=null===(t=this.parent)||void 0===t?void 0:t.context)&&void 0!==e?e:{},...this.container.selectors.getContext()}}run(e,t,r={}){return this.createExecution(e,r).start(t)}createExecution(e,t={}){const r={executor:this,params:{...t,extraContext:this.context}};"string"==typeof e?r.expression=e:r.ast=e;return new execution_Execution(r)}walkAst(e,t){for(const r of e.chain){const{function:e,arguments:n}=r,s=Pe(this.getFunctions(),e);s&&(r.arguments=Object(M.mapValues)(n,(e=>e.map((e=>null!=e&&"object"==typeof e?this.walkAst(e,t):e)))),t(s,r))}return e}inject(e,t){let r=0;return this.walkAst(Object(M.cloneDeep)(e),((e,n)=>{n.arguments=e.inject(n.arguments,t.filter((e=>e.name.includes(`l${r}_`))).map((e=>({...e,name:e.name.replace(`l${r}_`,"")})))),r++}))}extract(e){let t=0;const r=[];return{state:this.walkAst(Object(M.cloneDeep)(e),((e,n)=>{const{state:s,references:i}=e.extract(n.arguments);n.arguments=s,r.push(...i.map((e=>({...e,name:`l${t}_${e.name}`})))),t+=1})),references:r}}telemetry(e,t){return this.walkAst(Object(M.cloneDeep)(e),((e,r)=>{t=e.telemetry(r.arguments,t)})),t}getAllMigrations(){const e=new Set(Object.values(this.getFunctions()).map((e=>Object.keys(e.migrations))).flat(1)),t={};return e.forEach((e=>{t[e]=t=>({...this.migrate(t,e)})})),t}migrateToLatest(e){return Object(ze.migrateToLatest)(this.getAllMigrations(),e)}migrate(e,t){return this.walkAst(Object(M.cloneDeep)(e),((e,r)=>{e.migrations[t]&&({arguments:r.arguments,type:r.type}=e.migrations[t](r))}))}fork(){const e=new executor_Executor;return e.parent=this,e}}class expressions_services_ExpressionsService{constructor({executor:e=executor_Executor.createWithDefaults(),renderers:t=new expression_renderer_registry_ExpressionRendererRegistry}={}){C()(this,"children",new Map),C()(this,"parent",void 0),C()(this,"executor",void 0),C()(this,"renderers",void 0),C()(this,"getFunction",(e=>this.executor.getFunction(e))),C()(this,"getFunctions",(()=>this.executor.getFunctions())),C()(this,"getRenderer",(e=>(this.assertStart(),this.renderers.get(e)))),C()(this,"getRenderers",(()=>(this.assertStart(),this.renderers.toJS()))),C()(this,"getType",(e=>(this.assertStart(),this.executor.getType(e)))),C()(this,"getTypes",(()=>this.executor.getTypes())),C()(this,"registerFunction",(e=>this.executor.registerFunction(e))),C()(this,"registerType",(e=>this.executor.registerType(e))),C()(this,"registerRenderer",(e=>this.renderers.register(e))),C()(this,"fork",(e=>{this.assertSetup();const t=this.executor.fork(),r=this.renderers,n=new this.constructor({executor:t,renderers:r});return n.parent=this,e&&this.children.set(e,n),n})),C()(this,"execute",((e,t,r)=>{this.assertStart();const n=this.executor.createExecution(e,r);return n.start(t),n.contract})),C()(this,"run",((e,t,r)=>(this.assertStart(),this.executor.run(e,t,r)))),C()(this,"telemetry",((e,t={})=>this.executor.telemetry(e,t))),C()(this,"extract",(e=>this.executor.extract(e))),C()(this,"inject",((e,t)=>this.executor.inject(e,t))),C()(this,"getAllMigrations",(()=>this.executor.getAllMigrations())),C()(this,"migrateToLatest",(e=>this.executor.migrateToLatest(e))),this.executor=e,this.renderers=t}isStarted(){var e;return!!(expressions_services_ExpressionsService.started.has(this)||null!==(e=this.parent)&&void 0!==e&&e.isStarted())}assertSetup(){if(this.isStarted())throw new Error("The expression service is already started and can no longer be configured.")}assertStart(){if(!this.isStarted())throw new Error("The expressions service has not started yet.")}setup(...e){for(const e of[ee,te,ne,se,ie,oe,ce,pe,de,le,ge,_e,je])this.registerFunction(e);return this}start(...e){return expressions_services_ExpressionsService.started.add(this),this}stop(){expressions_services_ExpressionsService.started.delete(this)}}C()(expressions_services_ExpressionsService,"started",new WeakSet)},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){"use strict";r.r(t),r.d(t,"americanTypewriter",(function(){return n})),r.d(t,"arial",(function(){return s})),r.d(t,"baskerville",(function(){return i})),r.d(t,"bookAntiqua",(function(){return o})),r.d(t,"brushScript",(function(){return a})),r.d(t,"chalkboard",(function(){return u})),r.d(t,"didot",(function(){return c})),r.d(t,"futura",(function(){return l})),r.d(t,"gillSans",(function(){return p})),r.d(t,"helveticaNeue",(function(){return d})),r.d(t,"hoeflerText",(function(){return f})),r.d(t,"lucidaGrande",(function(){return h})),r.d(t,"myriad",(function(){return m})),r.d(t,"openSans",(function(){return g})),r.d(t,"optima",(function(){return v})),r.d(t,"palatino",(function(){return y})),r.d(t,"fonts",(function(){return x}));const n={label:"American Typewriter",value:"'American Typewriter', 'Courier New', Courier, Monaco, mono"},s={label:"Arial",value:"Arial, sans-serif"},i={label:"Baskerville",value:"Baskerville, Georgia, Garamond, 'Times New Roman', Times, serif"},o={label:"Book Antiqua",value:"'Book Antiqua', Georgia, Garamond, 'Times New Roman', Times, serif"},a={label:"Brush Script",value:"'Brush Script MT', 'Comic Sans', sans-serif"},u={label:"Chalkboard",value:"Chalkboard, 'Comic Sans', sans-serif"},c={label:"Didot",value:"Didot, Georgia, Garamond, 'Times New Roman', Times, serif"},l={label:"Futura",value:"Futura, Impact, Helvetica, Arial, sans-serif"},p={label:"Gill Sans",value:"'Gill Sans', 'Lucida Grande', 'Lucida Sans Unicode', Verdana, Helvetica, Arial, sans-serif"},d={label:"Helvetica Neue",value:"'Helvetica Neue', Helvetica, Arial, sans-serif"},f={label:"Hoefler Text",value:"'Hoefler Text', Garamond, Georgia, 'Times New Roman', Times, serif"},h={label:"Lucida Grande",value:"'Lucida Grande', 'Lucida Sans Unicode', Lucida, Verdana, Helvetica, Arial, sans-serif"},m={label:"Myriad",value:"Myriad, Helvetica, Arial, sans-serif"},g={label:"Open Sans",value:"'Open Sans', Helvetica, Arial, sans-serif"},v={label:"Optima",value:"Optima, 'Lucida Grande', 'Lucida Sans Unicode', Verdana, Helvetica, Arial, sans-serif"},y={label:"Palatino",value:"Palatino, 'Book Antiqua', Georgia, Garamond, 'Times New Roman', Times, serif"},x=[n,s,i,o,a,u,c,l,p,d,f,h,m,g,v,y]},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,r){"use strict";var n,s=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},i=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),o=[];function a(e){for(var t=-1,r=0;r<o.length;r++)if(o[r].identifier===e){t=r;break}return t}function u(e,t){for(var r={},n=[],s=0;s<e.length;s++){var i=e[s],u=t.base?i[0]+t.base:i[0],c=r[u]||0,l="".concat(u," ").concat(c);r[u]=c+1;var p=a(l),d={css:i[1],media:i[2],sourceMap:i[3]};-1!==p?(o[p].references++,o[p].updater(d)):o.push({identifier:l,updater:g(d,t),references:1}),n.push(l)}return n}function c(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var s=r.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var o=i(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var l,p=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function d(e,t,r,n){var s=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=p(t,s);else{var i=document.createTextNode(s),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function f(e,t,r){var n=r.css,s=r.media,i=r.sourceMap;if(s?e.setAttribute("media",s):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var h=null,m=0;function g(e,t){var r,n,s;if(t.singleton){var i=m++;r=h||(h=c(t)),n=d.bind(null,r,i,!1),s=d.bind(null,r,i,!0)}else r=c(t),n=f.bind(null,r,t),s=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else s()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=s());var r=u(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<r.length;n++){var s=a(r[n]);o[s].references--}for(var i=u(e,t),c=0;c<r.length;c++){var l=a(r[c]);0===o[l].references&&(o[l].updater(),o.splice(l,1))}r=i}}}},function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",n=e[3];if(!n)return r;if(t&&"function"==typeof btoa){var s=(o=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(u," */")),i=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[r].concat(i).concat([s]).join("\n")}var o,a,u;return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,n){"string"==typeof e&&(e=[[null,e,""]]);var s={};if(n)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(s[o]=!0)}for(var a=0;a<e.length;a++){var u=[].concat(e[a]);n&&s[u[0]]||(r&&(u[2]?u[2]="".concat(r," and ").concat(u[2]):u[2]=r),t.push(u))}},t}},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/kibanaUtils/common/state_containers");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){"use strict";var n,s="object"==typeof Reflect?Reflect:null,i=s&&"function"==typeof s.apply?s.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}v(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&v(e,"error",t,r)}(e,s,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function p(e,t,r,n){var s,i,o,a;if(c(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),o=i[t]),void 0===o)o=i[t]=r,++e._eventsCount;else if("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(s=l(e))>0&&o.length>s&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,a=u,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=d.bind(n);return s.listener=r,n.wrapFn=s,s}function h(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):g(s,s.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function v(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){n.once&&e.removeEventListener(t,s),r(i)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=s[e];if(void 0===u)return!1;if("function"==typeof u)i(u,this,t);else{var c=u.length,l=g(u,c);for(r=0;r<c;++r)i(l[r],this,t)}return!0},a.prototype.addListener=function(e,t){return p(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return p(this,e,t,!0)},a.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,s,i,o;if(c(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return h(this,e,!0)},a.prototype.rawListeners=function(e){return h(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getType=function(e){if(null==e)return"null";if("object"==typeof e){if(!e.type)throw new Error("Objects must have a type property");return e.type}return typeof e}},function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");if(Array.isArray(e))return e.map((e=>Math.pow(e,t)));return Math.pow(e,t)}}},function(e,t){e.exports=__kbnSharedDeps__.KbnStd},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(88),s=r(89),i=n.__importDefault(r(90)),o=function(e,t){return e.every((function(e,r){return s.equal(e,t[r])}))};t.default=function(e,t){i.default(e,t,o)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Fn",{enumerable:!0,get:function(){return s.Fn}}),Object.defineProperty(t,"Registry",{enumerable:!0,get:function(){return c.Registry}}),Object.defineProperty(t,"addRegistries",{enumerable:!0,get:function(){return l.addRegistries}}),Object.defineProperty(t,"castProvider",{enumerable:!0,get:function(){return o.castProvider}}),Object.defineProperty(t,"fromExpression",{enumerable:!0,get:function(){return n.fromExpression}}),Object.defineProperty(t,"getByAlias",{enumerable:!0,get:function(){return u.getByAlias}}),Object.defineProperty(t,"getType",{enumerable:!0,get:function(){return i.getType}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return a.parse}}),Object.defineProperty(t,"register",{enumerable:!0,get:function(){return l.register}}),Object.defineProperty(t,"registryFactory",{enumerable:!0,get:function(){return l.registryFactory}}),Object.defineProperty(t,"safeElementFromExpression",{enumerable:!0,get:function(){return n.safeElementFromExpression}}),Object.defineProperty(t,"toExpression",{enumerable:!0,get:function(){return n.toExpression}});var n=r(46),s=r(47),i=r(16),o=r(49),a=r(22),u=r(50),c=r(51),l=r(53)},function(e,t,r){"use strict";function n(e,t,r,s){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,n.prototype),i.expected=t,i.found=r,i.location=s,i.name="SyntaxError",i}function s(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,o=this.location.source+":"+i.line+":"+i.column;if(n){var a=this.location.end,u=s("",i.line.toString().length),c=n[i.line-1],l=i.line===a.line?a.column:c.length+1;t+="\n --\x3e "+o+"\n"+u+" |\n"+i.line+" | "+c+"\n"+u+" | "+s("",i.column-1)+s("",l-i.column,"^")}else t+="\n at "+o}return t},n.buildMessage=function(e,t){var r={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){var r,s={},i=(t=void 0!==t?t:{}).grammarSource,o={expression:de,argument:me},a=de,u="|",c="=",l="$",p="{",d="}",f='"',h="'",m="\\",g=/^[a-zA-Z0-9_\-]/,v=/^[ \t\r\n]/,y=/^["'(){}<>[\]$`|= \t\n\r]/,x=/^[^"'(){}<>[\]$`|= \t\n\r]/,b=/^[^"]/,A=/^[^']/,w=ie("|",!1),E=ae("function"),_=ie("=",!1),j=ie("$",!1),C=ie("{",!1),O=ie("}",!1),T=oe([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),M=ae("literal"),S=ie('"',!1),R=ie("'",!1),F=oe([" ","\t","\r","\n"],!1,!1),N=ie("\\",!1),k=oe(['"',"'","(",")","{","}","<",">","[","]","$","`","|","="," ","\t","\n","\r"],!1,!1),I=oe(['"',"'","(",")","{","}","<",">","[","]","$","`","|","="," ","\t","\n","\r"],!0,!1),L=oe(['"'],!0,!1),P=oe(["'"],!0,!1),$=function(e,t){return t},H=function(e,t){return Ae({type:"expression",chain:[e].concat(t)},ne(),se())},q=function(e,t){return Ae({type:"function",function:e,arguments:t},ne(),se())},D=function(e,t){return{name:e,value:t}},z=function(e){return{name:"_",value:e}},B=function(e){return e},U=function(e){return Ae(e,ne(),se())},G=function(e){return e},V=function(e){return e.reduce(((e,{name:t,value:r})=>({...e,[t]:(e[t]||[]).concat(r)})),{})},W=function(e){return e.join("")},Y=function(e){return e.join("")},J=function(e){var t=e.join("");return"null"===t?null:"true"===t||"false"!==t&&(isNaN(Number(t))?t:Number(t))},Z=function(e){return e},K=0,X=0,Q=[{line:1,column:1}],ee=0,te=[],re=0;if("startRule"in t){if(!(t.startRule in o))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=o[t.startRule]}function ne(){return e.substring(X,K)}function se(){return ce(X,K)}function ie(e,t){return{type:"literal",text:e,ignoreCase:t}}function oe(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function ae(e){return{type:"other",description:e}}function ue(t){var r,n=Q[t];if(n)return n;for(r=t-1;!Q[r];)r--;for(n={line:(n=Q[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Q[t]=n,n}function ce(e,t){var r=ue(e),n=ue(t);return{source:i,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function le(e){K<ee||(K>ee&&(ee=K,te=[]),te.push(e))}function pe(e,t,r){return new n(n.buildMessage(e,t),e,t,r)}function de(){var t,r,n,i,o,a;if(t=K,ve()===s&&null,(r=fe())!==s){for(n=[],i=K,124===e.charCodeAt(K)?(o=u,K++):(o=s,0===re&&le(w)),o!==s?(ve()===s&&null,(a=fe())!==s?(X=i,i=$(r,a)):(K=i,i=s)):(K=i,i=s);i!==s;)n.push(i),i=K,124===e.charCodeAt(K)?(o=u,K++):(o=s,0===re&&le(w)),o!==s?(ve()===s&&null,(a=fe())!==s?(X=i,i=$(r,a)):(K=i,i=s)):(K=i,i=s);X=t,t=H(r,n)}else K=t,t=s;return t}function fe(){var e,t,r;return re++,e=K,(t=ge())!==s?(r=function(){var e,t,r,n;e=K,t=[],r=K,ve()!==s&&(n=he())!==s?(X=r,r=G(n)):(K=r,r=s);for(;r!==s;)t.push(r),r=K,ve()!==s&&(n=he())!==s?(X=r,r=G(n)):(K=r,r=s);r=ve(),r===s&&(r=null);return X=e,e=V(t),e}(),X=e,e=q(t,r)):(K=e,e=s),re--,e===s&&(t=s,0===re&&le(E)),e}function he(){var t,r,n,i;return t=K,(r=ge())!==s?(ve()===s&&null,61===e.charCodeAt(K)?(n=c,K++):(n=s,0===re&&le(_)),n!==s?(ve()===s&&null,(i=me())!==s?(X=t,t=D(r,i)):(K=t,t=s)):(K=t,t=s)):(K=t,t=s),t===s&&(t=K,(r=me())!==s&&(X=t,r=z(r)),t=r),t}function me(){var t,r,n,i,o;return t=K,36===e.charCodeAt(K)?(r=l,K++):(r=s,0===re&&le(j)),r===s&&(r=null),123===e.charCodeAt(K)?(n=p,K++):(n=s,0===re&&le(C)),n!==s&&(i=de())!==s?(125===e.charCodeAt(K)?(o=d,K++):(o=s,0===re&&le(O)),o!==s?(X=t,t=B(i)):(K=t,t=s)):(K=t,t=s),t===s&&(t=K,r=function(){var t;re++,t=function(){var t,r,n,i;t=K,34===e.charCodeAt(K)?(r=f,K++):(r=s,0===re&&le(S));if(r!==s){for(n=[],i=xe();i!==s;)n.push(i),i=xe();34===e.charCodeAt(K)?(i=f,K++):(i=s,0===re&&le(S)),i!==s?(X=t,t=Y(n)):(K=t,t=s)}else K=t,t=s;if(t===s)if(t=K,39===e.charCodeAt(K)?(r=h,K++):(r=s,0===re&&le(R)),r!==s){for(n=[],i=be();i!==s;)n.push(i),i=be();39===e.charCodeAt(K)?(i=h,K++):(i=s,0===re&&le(R)),i!==s?(X=t,t=Y(n)):(K=t,t=s)}else K=t,t=s;return t}(),t===s&&(t=function(){var e,t,r;if(e=K,t=[],r=ye(),r!==s)for(;r!==s;)t.push(r),r=ye();else t=s;t!==s&&(X=e,t=J(t));return e=t,e}());re--,t===s&&(s,0===re&&le(M));return t}(),r!==s&&(X=t,r=U(r)),t=r),t}function ge(){var t,r,n;if(t=K,r=[],g.test(e.charAt(K))?(n=e.charAt(K),K++):(n=s,0===re&&le(T)),n!==s)for(;n!==s;)r.push(n),g.test(e.charAt(K))?(n=e.charAt(K),K++):(n=s,0===re&&le(T));else r=s;return r!==s&&(X=t,r=W(r)),t=r}function ve(){var t,r;if(t=[],v.test(e.charAt(K))?(r=e.charAt(K),K++):(r=s,0===re&&le(F)),r!==s)for(;r!==s;)t.push(r),v.test(e.charAt(K))?(r=e.charAt(K),K++):(r=s,0===re&&le(F));else t=s;return t}function ye(){var t,r,n;return t=K,92===e.charCodeAt(K)?(r=m,K++):(r=s,0===re&&le(N)),r!==s?(y.test(e.charAt(K))?(n=e.charAt(K),K++):(n=s,0===re&&le(k)),n===s&&(92===e.charCodeAt(K)?(n=m,K++):(n=s,0===re&&le(N))),n!==s?(X=t,t=Z(n)):(K=t,t=s)):(K=t,t=s),t===s&&(x.test(e.charAt(K))?(t=e.charAt(K),K++):(t=s,0===re&&le(I))),t}function xe(){var t,r,n;return t=K,92===e.charCodeAt(K)?(r=m,K++):(r=s,0===re&&le(N)),r!==s?(34===e.charCodeAt(K)?(n=f,K++):(n=s,0===re&&le(S)),n===s&&(92===e.charCodeAt(K)?(n=m,K++):(n=s,0===re&&le(N))),n!==s?(X=t,t=Z(n)):(K=t,t=s)):(K=t,t=s),t===s&&(b.test(e.charAt(K))?(t=e.charAt(K),K++):(t=s,0===re&&le(L))),t}function be(){var t,r,n;return t=K,92===e.charCodeAt(K)?(r=m,K++):(r=s,0===re&&le(N)),r!==s?(39===e.charCodeAt(K)?(n=h,K++):(n=s,0===re&&le(R)),n===s&&(92===e.charCodeAt(K)?(n=m,K++):(n=s,0===re&&le(N))),n!==s?(X=t,t=Z(n)):(K=t,t=s)):(K=t,t=s),t===s&&(A.test(e.charAt(K))?(t=e.charAt(K),K++):(t=s,0===re&&le(P))),t}function Ae(e,r,{start:{offset:n},end:{offset:s}}){return t.addMeta?{node:e,text:r,start:n,end:s}:e}if((r=a())!==s&&K===e.length)return r;throw r!==s&&K<e.length&&le({type:"end"}),pe(te,ee<e.length?e.charAt(ee):null,ee<e.length?ce(ee,ee+1):ce(ee,ee))}}},function(e,t){e.exports={add:function(...e){if(1===e.length)return Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0];return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,r)=>e+t[r]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function r(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}e.exports={size:r},r.skipNumberValidation=!0},function(e,t){const r=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return r(e,t)}));if(e<0)throw new Error("Must be greater than 0");return r(e,t)}}},function(e,t){e.exports={max:function(...e){if(1===e.length)return Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0];return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,r)=>Math.max(e,t[r])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const r=e[t].length;return e[t].map(((t,n)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==r)throw new Error("Array length mismatch");return e[n]}return e}))))}}},function(e,t){e.exports={min:function(...e){if(1===e.length)return Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0];return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,r)=>Math.min(e,t[r])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,r)=>e-t[r]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},function(e,t,r){const{get:n}=r(3),s=r(54),{parse:i}=r(55),{functions:o}=r(56);const a=s((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return i(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function u(e,t,r){const s=Object.assign({},o,r);return i(e);function i(e){if("number"==typeof e)return e;if("function"===e.type)return function(e){const{name:t,args:r}=e,n=s[t];if(!n)throw new Error(`No such function: ${t}`);const o=r.map(i);return n.skipNumberValidation||c(o)?n(...o):NaN}(e);if("variable"===e.type){const r=function(e,t){const r=n(e,t);return void 0!==r?r:e[t]}(t,e.value);if(void 0===r)throw new Error(`Unknown variable: ${e.value}`);return r}if("namedArgument"===e.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${e.name}`)}}function c(e){return e.every((e=>Array.isArray(e)?c(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:a,evaluate:function(e,t={},r={}){return t=t||{},u(a(e),t,r)},interpret:u}},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/inspector/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){e.exports=r(15)(1076)},function(e,t){e.exports=__kbnSharedDeps__.Classnames},function(e,t){e.exports=__kbnSharedDeps__.Theme},function(e,t,r){r(36),__kbnBundles__.define("plugin/expressions/public",r,91),__kbnBundles__.define("plugin/expressions/common",r,5),__kbnBundles__.define("plugin/expressions/common/fonts",r,8)},function(e,t,r){r.p=window.__kbnPublicPath__.expressions},function(e,t,r){switch(window.__kbnThemeTag__){case"v7dark":return r(38);case"v7light":return r(40);case"v8dark":return r(42);case"v8light":return r(44)}},function(e,t,r){var n=r(10),s=r(39);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};n(s,i);e.exports=s.locals||{}},function(e,t,r){(t=r(11)(!1)).push([e.i,".expExpressionRenderer{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.expExpressionRenderer__expression{width:100%;height:100%}.expExpressionRenderer-isEmpty .expExpressionRenderer__expression,.expExpressionRenderer-hasError .expExpressionRenderer__expression{display:none}\n",""]),e.exports=t},function(e,t,r){var n=r(10),s=r(41);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};n(s,i);e.exports=s.locals||{}},function(e,t,r){(t=r(11)(!1)).push([e.i,".expExpressionRenderer{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.expExpressionRenderer__expression{width:100%;height:100%}.expExpressionRenderer-isEmpty .expExpressionRenderer__expression,.expExpressionRenderer-hasError .expExpressionRenderer__expression{display:none}\n",""]),e.exports=t},function(e,t,r){var n=r(10),s=r(43);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};n(s,i);e.exports=s.locals||{}},function(e,t,r){(t=r(11)(!1)).push([e.i,".expExpressionRenderer{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.expExpressionRenderer__expression{width:100%;height:100%}.expExpressionRenderer-isEmpty .expExpressionRenderer__expression,.expExpressionRenderer-hasError .expExpressionRenderer__expression{display:none}\n",""]),e.exports=t},function(e,t,r){var n=r(10),s=r(45);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};n(s,i);e.exports=s.locals||{}},function(e,t,r){(t=r(11)(!1)).push([e.i,".expExpressionRenderer{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.expExpressionRenderer__expression{width:100%;height:100%}.expExpressionRenderer-isEmpty .expExpressionRenderer__expression,.expExpressionRenderer-hasError .expExpressionRenderer__expression{display:none}\n",""]),e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromExpression=c,t.safeElementFromExpression=function(e){try{return c(e)}catch(e){return c("markdown\n\"## Crud.\nCanvas could not parse this element's expression. I am so sorry this error isn't more useful. I promise it will be soon.\n\nThanks for understanding,\n#### Management\n\"")}},t.toExpression=function(e,t="expression"){if("argument"===t)return i(e);if(!["expression","function"].includes((0,n.getType)(e)))throw new Error("Expression must be an expression or argument function");if("expression"===(0,n.getType)(e)){if(!Array.isArray(e.chain))throw new Error("Expressions must contain a chain");return u(e.chain)}const r=o(e);return a(e.function,r)};var n=r(16),s=r(22);function i(e,t,r=0){const s=(0,n.getType)(e);function i(e,t){return null==e||"_"===e?t:`${e}=${t}`}if("string"===s){return i(t,`"${e.replace(/[\\"]/g,"\\$&")}"`)}if("boolean"===s||"null"===s||"number"===s)return i(t,`${e}`);if("expression"===s)return i(t,`{${u(e.chain,r+1)}}`);throw new Error(`Invalid argument type in AST: ${s}`)}function o(e,t=0){const r=e.arguments;if(!("object"==typeof r&&null!=r&&!Array.isArray(r)))throw new Error("Arguments can only be an object");const n=Object.keys(r);return n.map((e=>r[e].reduce(((r,n)=>{const s=i(n,e,t),o=r.split("\n").pop().length;return 0===t&&o+s.length>80?`${r}\n  ${s}`:o>0?`${r} ${s}`:s}),"")))}function a(e,t){return t&&0!==t.length?`${e} ${t.join(" ")}`:e}function u(e,t=0){if(!e)throw new Error("Expressions must contain a chain");const r=t>0?" | ":"\n| ";return e.map((e=>{if("function"===(0,n.getType)(e)){const r=e.function;if(!r||0===r.length)throw new Error("Functions must have a function name");return a(r,o(e,t))}}),[]).join(r)}function c(e,t="expression"){try{return(0,s.parse)(String(e),{startRule:t})}catch(e){throw new Error(`Unable to parse expression: ${e.message}`)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fn=function(e){this.name=e.name,this.type=e.type,this.aliases=e.aliases||[],this.fn=(...t)=>Promise.resolve(e.fn(...t)),this.help=e.help||"",this.args=(0,n.mapValues)(e.args||{},((e,t)=>new s.Arg({name:t,...e}))),this.context=e.context||{},this.accepts=e=>!this.context.types||(0,n.includes)(this.context.types,e)};var n=r(3),s=r(48)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Arg=function(e){if("_"===e.name)throw Error("Arg names must not be _. Use it in aliases instead.");this.name=e.name,this.required=e.required||!1,this.help=e.help||"",this.types=e.types||[],this.default=e.default,this.aliases=e.aliases||[],this.multi=null!=e.multi&&e.multi,this.resolve=null==e.resolve||e.resolve,this.options=e.options||[],this.accepts=t=>!this.types.length||(0,n.includes)(e.types,t)};var n=r(3)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castProvider=function(e){return function(t,r){if(!r||0===r.length)return t;const s=(0,n.getType)(t);if(r.includes(s))return t;const i=e[s];for(let n=0;n<r.length;n++){if(i&&i.castsTo(r[n]))return i.to(t,r[n],e);const o=e[r[n]];if(o&&o.castsFrom(s))return o.from(t,e)}throw new Error(`Can not cast '${s}' to any of '${r.join(", ")}'`)}};var n=r(16)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getByAlias=function(e,t){const r=t.toLowerCase();return Object.values(e).find((({name:e,aliases:t})=>e.toLowerCase()===r||(t||[]).some((e=>e.toLowerCase()===r))))}},function(e,t,r){"use strict";var n=r(52);Object.defineProperty(t,"__esModule",{value:!0}),t.Registry=void 0;var s=n(r(0)),i=r(3);t.Registry=class Registry{constructor(e="name"){if((0,s.default)(this,"_prop",void 0),(0,s.default)(this,"_indexed",void 0),"string"!=typeof e)throw new Error("Registry property name must be a string");this._prop=e,this._indexed=new Object}wrapper(e){return e}register(e){const t="function"==typeof e?e():e;if("object"!=typeof t||!t[this._prop])throw new Error(`Registered functions must return an object with a ${this._prop} property`);this._indexed[t[this._prop].toLowerCase()]=this.wrapper(t)}toJS(){return Object.keys(this._indexed).reduce(((e,t)=>(e[t]=this.get(t),e)),{})}toArray(){return Object.keys(this._indexed).map((e=>this.get(e)))}get(e){if(void 0===e)return null;const t=e.toLowerCase();return this._indexed[t]?(0,i.clone)(this._indexed[t]):null}getProp(){return this._prop}reset(){this._indexed=new Object}}},function(e,t,r){e.exports=r(15)(1077)},function(e,t,r){"use strict";function n(e,t){return Object.keys(t).forEach((r=>{if(!e[r])throw new Error(`There is no registry named "${r}".`);if(!e[r].register)throw new Error(`Registry "${r}" must have a register function.`);t[r].forEach((t=>e[r].register(t)))})),e}Object.defineProperty(t,"__esModule",{value:!0}),t.addRegistries=function(e,t){return Object.keys(t).forEach((r=>{if(e[r])throw new Error(`There is already a registry named "${r}".`);e[r]=t[r]})),e},t.register=n,t.registryFactory=function(e){return{registries:()=>e,register:t=>n(e,t)}}},function(e,t,r){"use strict";function n(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}e.exports=function(e,t){var r;void 0===t&&(t=n);var s,i=[],o=!1;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return o&&r===this&&t(n,i)||(s=e.apply(this,n),o=!0,r=this,i=n),s}}},function(e,t,r){"use strict";function n(e,t,r,s){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,n.prototype),i.expected=t,i.found=r,i.location=s,i.name="SyntaxError",i}function s(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,o=this.location.source+":"+i.line+":"+i.column;if(n){var a=this.location.end,u=s("",i.line.toString().length),c=n[i.line-1],l=i.line===a.line?a.column:c.length+1;t+="\n --\x3e "+o+"\n"+u+" |\n"+i.line+" | "+c+"\n"+u+" | "+s("",i.column-1)+s("",l-i.column,"^")}else t+="\n at "+o}return t},n.buildMessage=function(e,t){var r={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){var r,s={},i=(t=void 0!==t?t:{}).grammarSource,o={start:Le},a=Le,u='"',c='\\"',l="'",p="\\'",d="+",f="-",h="*",m="/",g="(",v=")",y=",",x="=",b=".",A="0",w=/^[ \t\n\r]/,E=/^[0-9A-Za-z._@[\]\-]/,_=/^[^"]/,j=/^[^']/,C=/^[a-zA-Z_]/,O=/^[a-zA-Z_\-]/,T=/^[eE]/,M=/^[1-9]/,S=/^[0-9]/,R=Re("whitespace"),F=Se([" ","\t","\n","\r"],!1,!1),N=(Se([" "],!1,!1),Se(['"',"'"],!1,!1),Se([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),Se([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),k=Re("literal"),I=Me('"',!1),L=Me('\\"',!1),P=Se(['"'],!0,!1),$=Me("'",!1),H=Me("\\'",!1),q=Se(["'"],!0,!1),D=Me("+",!1),z=Me("-",!1),B=Me("*",!1),U=Me("/",!1),G=Me("(",!1),V=Me(")",!1),W=Re("arguments"),Y=Me(",",!1),J=Se([["a","z"],["A","Z"],"_"],!1,!1),Z=Me("=",!1),K=Re("function"),X=Se([["a","z"],["A","Z"],"_","-"],!1,!1),Q=Re("number"),ee=Se(["e","E"],!1,!1),te=Re("exponent"),re=Me(".",!1),ne=Me("0",!1),se=Se([["1","9"]],!1,!1),ie=Se([["0","9"]],!1,!1),oe=function(e){return e},ae=function(){return'"'},ue=function(e){return{type:"variable",value:e.join(""),location:Ve(Te()),text:Oe()}},ce=function(){return"'"},le=function(e){return{type:"variable",value:e.join(""),location:Ve(Te()),text:Oe()}},pe=function(e){return{type:"variable",value:e.join(""),location:Ve(Te()),text:Oe()}},de=function(e,t){const r=t.reduce(((e,t)=>({type:"function",name:"+"===t[0]?"add":"subtract",args:[e,t[1]]})),e);return"object"==typeof r&&(r.location=Ve(Te()),r.text=Oe()),r},fe=function(e,t){const r=t.reduce(((e,t)=>({type:"function",name:"*"===t[0]?"multiply":"divide",args:[e,t[1]]})),e);return"object"==typeof r&&(r.location=Ve(Te()),r.text=Oe()),r},he=function(e){return e},me=function(e,t){return t},ge=function(e,t){return[e].concat(t)},ve=function(e){return e.join("")},ye=function(e,t){return{type:"namedArgument",name:e.join(""),value:t,location:Ve(Te()),text:Oe()}},xe=function(e,t){return{type:"function",name:e.join(""),args:t||[],location:Ve(Te()),text:Oe()}},be=function(){return parseFloat(Oe())},Ae=0,we=0,Ee=[{line:1,column:1}],_e=0,je=[],Ce=0;if("startRule"in t){if(!(t.startRule in o))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=o[t.startRule]}function Oe(){return e.substring(we,Ae)}function Te(){return Ne(we,Ae)}function Me(e,t){return{type:"literal",text:e,ignoreCase:t}}function Se(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Re(e){return{type:"other",description:e}}function Fe(t){var r,n=Ee[t];if(n)return n;for(r=t-1;!Ee[r];)r--;for(n={line:(n=Ee[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ee[t]=n,n}function Ne(e,t){var r=Fe(e),n=Fe(t);return{source:i,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function ke(e){Ae<_e||(Ae>_e&&(_e=Ae,je=[]),je.push(e))}function Ie(e,t,r){return new n(n.buildMessage(e,t),e,t,r)}function Le(){return qe()}function Pe(){var t,r;for(Ce++,t=[],w.test(e.charAt(Ae))?(r=e.charAt(Ae),Ae++):(r=s,0===Ce&&ke(F));r!==s;)t.push(r),w.test(e.charAt(Ae))?(r=e.charAt(Ae),Ae++):(r=s,0===Ce&&ke(F));return Ce--,r=s,0===Ce&&ke(R),t}function $e(){var t;return E.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=s,0===Ce&&ke(N)),t}function He(){var t,r;return Ce++,t=Ae,Pe(),(r=Ue())===s&&(r=function(){var t,r,n,i,o;t=Ae,Pe(),34===e.charCodeAt(Ae)?(r=u,Ae++):(r=s,0===Ce&&ke(I));if(r!==s){for(n=[],i=Ae,e.substr(Ae,2)===c?(o=c,Ae+=2):(o=s,0===Ce&&ke(L)),o!==s&&(we=i,o=ae()),(i=o)===s&&(_.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(P)));i!==s;)n.push(i),i=Ae,e.substr(Ae,2)===c?(o=c,Ae+=2):(o=s,0===Ce&&ke(L)),o!==s&&(we=i,o=ae()),(i=o)===s&&(_.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(P)));34===e.charCodeAt(Ae)?(i=u,Ae++):(i=s,0===Ce&&ke(I)),i!==s?(o=Pe(),we=t,t=ue(n)):(Ae=t,t=s)}else Ae=t,t=s;if(t===s){if(t=Ae,Pe(),39===e.charCodeAt(Ae)?(r=l,Ae++):(r=s,0===Ce&&ke($)),r!==s){for(n=[],i=Ae,e.substr(Ae,2)===p?(o=p,Ae+=2):(o=s,0===Ce&&ke(H)),o!==s&&(we=i,o=ce()),(i=o)===s&&(j.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(q)));i!==s;)n.push(i),i=Ae,e.substr(Ae,2)===p?(o=p,Ae+=2):(o=s,0===Ce&&ke(H)),o!==s&&(we=i,o=ce()),(i=o)===s&&(j.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(q)));39===e.charCodeAt(Ae)?(i=l,Ae++):(i=s,0===Ce&&ke($)),i!==s?(o=Pe(),we=t,t=le(n)):(Ae=t,t=s)}else Ae=t,t=s;if(t===s){if(t=Ae,Pe(),r=[],(n=$e())!==s)for(;n!==s;)r.push(n),n=$e();else r=s;r!==s?(n=Pe(),we=t,t=pe(r)):(Ae=t,t=s)}}return t}()),r!==s?(Pe(),we=t,t=oe(r)):(Ae=t,t=s),Ce--,t===s&&(s,0===Ce&&ke(k)),t}function qe(){var t,r,n,i,o,a;if(t=Ae,Pe(),(r=De())!==s){if(n=[],i=Ae,43===e.charCodeAt(Ae)?(o=d,Ae++):(o=s,0===Ce&&ke(D)),o===s&&(45===e.charCodeAt(Ae)?(o=f,Ae++):(o=s,0===Ce&&ke(z))),o!==s&&(a=De())!==s?i=o=[o,a]:(Ae=i,i=s),i!==s)for(;i!==s;)n.push(i),i=Ae,43===e.charCodeAt(Ae)?(o=d,Ae++):(o=s,0===Ce&&ke(D)),o===s&&(45===e.charCodeAt(Ae)?(o=f,Ae++):(o=s,0===Ce&&ke(z))),o!==s&&(a=De())!==s?i=o=[o,a]:(Ae=i,i=s);else n=s;n!==s?(i=Pe(),we=t,t=de(r,n)):(Ae=t,t=s)}else Ae=t,t=s;return t===s&&(t=De()),t}function De(){var t,r,n,i,o,a;if(t=Ae,Pe(),(r=ze())!==s){for(n=[],i=Ae,42===e.charCodeAt(Ae)?(o=h,Ae++):(o=s,0===Ce&&ke(B)),o===s&&(47===e.charCodeAt(Ae)?(o=m,Ae++):(o=s,0===Ce&&ke(U))),o!==s&&(a=ze())!==s?i=o=[o,a]:(Ae=i,i=s);i!==s;)n.push(i),i=Ae,42===e.charCodeAt(Ae)?(o=h,Ae++):(o=s,0===Ce&&ke(B)),o===s&&(47===e.charCodeAt(Ae)?(o=m,Ae++):(o=s,0===Ce&&ke(U))),o!==s&&(a=ze())!==s?i=o=[o,a]:(Ae=i,i=s);i=Pe(),we=t,t=fe(r,n)}else Ae=t,t=s;return t===s&&(t=ze()),t}function ze(){var t;return(t=function(){var t,r,n,i;t=Ae,Pe(),40===e.charCodeAt(Ae)?(r=g,Ae++):(r=s,0===Ce&&ke(G));r!==s?(Pe(),(n=qe())!==s?(Pe(),41===e.charCodeAt(Ae)?(i=v,Ae++):(i=s,0===Ce&&ke(V)),i!==s?(Pe(),we=t,t=he(n)):(Ae=t,t=s)):(Ae=t,t=s)):(Ae=t,t=s);return t}())===s&&(t=function(){var t,r,n,i,o;Ce++,t=Ae,Pe(),r=[],O.test(e.charAt(Ae))?(n=e.charAt(Ae),Ae++):(n=s,0===Ce&&ke(X));if(n!==s)for(;n!==s;)r.push(n),O.test(e.charAt(Ae))?(n=e.charAt(Ae),Ae++):(n=s,0===Ce&&ke(X));else r=s;r!==s?(40===e.charCodeAt(Ae)?(n=g,Ae++):(n=s,0===Ce&&ke(G)),n!==s?(Pe(),i=function(){var t,r,n,i,o,a,u;if(Ce++,t=Ae,r=Be(),r!==s){for(n=[],i=Ae,o=Pe(),44===e.charCodeAt(Ae)?(a=y,Ae++):(a=s,0===Ce&&ke(Y)),a!==s?(Pe(),(u=Be())!==s?(we=i,i=me(r,u)):(Ae=i,i=s)):(Ae=i,i=s);i!==s;)n.push(i),i=Ae,o=Pe(),44===e.charCodeAt(Ae)?(a=y,Ae++):(a=s,0===Ce&&ke(Y)),a!==s?(Pe(),(u=Be())!==s?(we=i,i=me(r,u)):(Ae=i,i=s)):(Ae=i,i=s);i=Pe(),44===e.charCodeAt(Ae)?(o=y,Ae++):(o=s,0===Ce&&ke(Y)),o===s&&(o=null),we=t,t=ge(r,n)}else Ae=t,t=s;Ce--,t===s&&(r=s,0===Ce&&ke(W));return t}(),i===s&&(i=null),Pe(),41===e.charCodeAt(Ae)?(o=v,Ae++):(o=s,0===Ce&&ke(V)),o!==s?(Pe(),we=t,t=xe(r,i)):(Ae=t,t=s)):(Ae=t,t=s)):(Ae=t,t=s);Ce--,t===s&&(s,0===Ce&&ke(K));return t}())===s&&(t=He()),t}function Be(){var t,r,n,i,o;if(t=Ae,r=[],C.test(e.charAt(Ae))?(n=e.charAt(Ae),Ae++):(n=s,0===Ce&&ke(J)),n!==s)for(;n!==s;)r.push(n),C.test(e.charAt(Ae))?(n=e.charAt(Ae),Ae++):(n=s,0===Ce&&ke(J));else r=s;return r!==s?(n=Pe(),61===e.charCodeAt(Ae)?(i=x,Ae++):(i=s,0===Ce&&ke(Z)),i!==s?(Pe(),(o=Ue())===s&&(o=function(){var t,r,n,i,o;if(t=Ae,34===e.charCodeAt(Ae)?(r=u,Ae++):(r=s,0===Ce&&ke(I)),r!==s){for(n=[],i=Ae,e.substr(Ae,2)===c?(o=c,Ae+=2):(o=s,0===Ce&&ke(L)),o!==s&&(we=i,o=ae()),(i=o)===s&&(_.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(P)));i!==s;)n.push(i),i=Ae,e.substr(Ae,2)===c?(o=c,Ae+=2):(o=s,0===Ce&&ke(L)),o!==s&&(we=i,o=ae()),(i=o)===s&&(_.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(P)));34===e.charCodeAt(Ae)?(i=u,Ae++):(i=s,0===Ce&&ke(I)),i!==s?(we=t,t=ve(n)):(Ae=t,t=s)}else Ae=t,t=s;if(t===s){if(t=Ae,39===e.charCodeAt(Ae)?(r=l,Ae++):(r=s,0===Ce&&ke($)),r!==s){for(n=[],i=Ae,e.substr(Ae,2)===p?(o=p,Ae+=2):(o=s,0===Ce&&ke(H)),o!==s&&(we=i,o=ce()),(i=o)===s&&(j.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(q)));i!==s;)n.push(i),i=Ae,e.substr(Ae,2)===p?(o=p,Ae+=2):(o=s,0===Ce&&ke(H)),o!==s&&(we=i,o=ce()),(i=o)===s&&(j.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=s,0===Ce&&ke(q)));39===e.charCodeAt(Ae)?(i=l,Ae++):(i=s,0===Ce&&ke($)),i!==s?(we=t,t=ve(n)):(Ae=t,t=s)}else Ae=t,t=s;if(t===s){if(t=Ae,r=[],(n=$e())!==s)for(;n!==s;)r.push(n),n=$e();else r=s;r!==s&&(we=t,r=ve(r)),t=r}}return t}()),o!==s?(Pe(),we=t,t=ye(r,o)):(Ae=t,t=s)):(Ae=t,t=s)):(Ae=t,t=s),t===s&&(t=qe()),t}function Ue(){var t,r,n,i,o;return Ce++,t=Ae,45===e.charCodeAt(Ae)?(r=f,Ae++):(r=s,0===Ce&&ke(z)),r===s&&(r=null),n=function(){var t,r,n,i;48===e.charCodeAt(Ae)?(t=A,Ae++):(t=s,0===Ce&&ke(ne));if(t===s)if(t=Ae,M.test(e.charAt(Ae))?(r=e.charAt(Ae),Ae++):(r=s,0===Ce&&ke(se)),r!==s){for(n=[],i=Ge();i!==s;)n.push(i),i=Ge();t=r=[r,n]}else Ae=t,t=s;return t}(),n!==s?(i=function(){var t,r,n,i;t=Ae,46===e.charCodeAt(Ae)?(r=b,Ae++):(r=s,0===Ce&&ke(re));if(r!==s){if(n=[],(i=Ge())!==s)for(;i!==s;)n.push(i),i=Ge();else n=s;n!==s?t=r=[r,n]:(Ae=t,t=s)}else Ae=t,t=s;return t}(),i===s&&(i=null),o=function(){var t,r,n,i,o;if(Ce++,t=Ae,r=function(){var t;T.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=s,0===Ce&&ke(ee));return t}(),r!==s){if(45===e.charCodeAt(Ae)?(n=f,Ae++):(n=s,0===Ce&&ke(z)),n===s&&(n=null),i=[],(o=Ge())!==s)for(;o!==s;)i.push(o),o=Ge();else i=s;i!==s?t=r=[r,n,i]:(Ae=t,t=s)}else Ae=t,t=s;Ce--,t===s&&(r=s,0===Ce&&ke(te));return t}(),o===s&&(o=null),we=t,t=be()):(Ae=t,t=s),Ce--,t===s&&(r=s,0===Ce&&ke(Q)),t}function Ge(){var t;return S.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=s,0===Ce&&ke(ie)),t}function Ve(e){return{min:e.start.offset,max:e.end.offset}}if((r=a())!==s&&Ae===e.length)return r;throw r!==s&&Ae<e.length&&ke({type:"end"}),Ie(je,_e<e.length?e.charAt(_e):null,_e<e.length?Ne(_e,_e+1):Ne(_e,_e))}}},function(e,t,r){const{abs:n}=r(57),{add:s}=r(23),{cbrt:i}=r(58),{ceil:o}=r(59),{clamp:a}=r(60),{cos:u}=r(61),{count:c}=r(62),{cube:l}=r(63),{degtorad:p}=r(64),{divide:d}=r(65),{exp:f}=r(66),{first:h}=r(67),{fix:m}=r(68),{floor:g}=r(69),{last:v}=r(70),{log:y}=r(25),{log10:x}=r(71),{max:b}=r(26),{mean:A}=r(72),{median:w}=r(73),{min:E}=r(28),{mod:_}=r(74),{mode:j}=r(75),{multiply:C}=r(76),{pi:O}=r(77),{pow:T}=r(17),{radtodeg:M}=r(78),{random:S}=r(79),{range:R}=r(80),{round:F}=r(81),{sin:N}=r(82),{size:k}=r(24),{sqrt:I}=r(83),{square:L}=r(84),{subtract:P}=r(29),{sum:$}=r(85),{tan:H}=r(86),{unique:q}=r(87);e.exports={functions:{abs:n,add:s,cbrt:i,ceil:o,clamp:a,cos:u,count:c,cube:l,degtorad:p,divide:d,exp:f,first:h,fix:m,floor:g,last:v,log:y,log10:x,max:b,mean:A,median:w,min:E,mod:_,mode:j,multiply:C,pi:O,pow:T,radtodeg:M,random:S,range:R,round:F,sin:N,size:k,sqrt:I,square:L,subtract:P,sum:$,tan:H,unique:q}}},function(e,t){e.exports={abs:function(e){if(Array.isArray(e))return e.map((e=>Math.abs(e)));return Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){if(Array.isArray(e))return e.map((e=>Math.cbrt(e)));return Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){if(Array.isArray(e))return e.map((e=>Math.ceil(e)));return Math.ceil(e)}}},function(e,t){const r=(e,t,r)=>{if(t>r)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),r)};e.exports={clamp:function(e,t,n){if(null===n)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(n)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==n.length||e.length!==t.length)throw new Error("Array length mismatch");return n.map(((n,s)=>r(e[s],t[s],n)))}if(Array.isArray(e)){if(e.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,s)=>r(e[s],t,n)))}if(Array.isArray(t)){if(t.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,s)=>r(e,t[s],n)))}return n.map((n=>r(e,t,n)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>r(e,t[n])))}if(Array.isArray(e))return e.map((e=>r(e,t,n)));if(Array.isArray(t))return t.map((t=>r(e,t,n)));return r(e,t,n)}}},function(e,t){e.exports={cos:function(e){if(Array.isArray(e))return e.map((e=>Math.cos(e)));return Math.cos(e)}}},function(e,t,r){const{size:n}=r(24);function s(e){return n(e)}e.exports={count:s},s.skipNumberValidation=!0},function(e,t,r){const{pow:n}=r(17);e.exports={cube:function(e){return n(e,3)}}},function(e,t){e.exports={degtorad:function(e){if(Array.isArray(e))return e.map((e=>e*Math.PI/180));return e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,r)=>{if(0===t[r])throw new Error("Cannot divide by 0");return e/t[r]}))}if(Array.isArray(t))return t.map((t=>e/t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){if(Array.isArray(e))return e.map((e=>Math.exp(e)));return Math.exp(e)}}},function(e,t){function r(e){return Array.isArray(e)?e[0]:e}e.exports={first:r},r.skipNumberValidation=!0},function(e,t){const r=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){if(Array.isArray(e))return e.map((e=>r(e)));return r(e)}}},function(e,t){e.exports={floor:function(e){if(Array.isArray(e))return e.map((e=>Math.floor(e)));return Math.floor(e)}}},function(e,t){function r(e){return Array.isArray(e)?e[e.length-1]:e}e.exports={last:r},r.skipNumberValidation=!0},function(e,t,r){const{log:n}=r(25);e.exports={log10:function(e){return n(e,10)}}},function(e,t,r){const{add:n}=r(23);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?n(e[0])/e[0].length:e[0];const t=n(...e);if(Array.isArray(t))return t.map((t=>t/e.length));return t/e.length}}},function(e,t,r){const{transpose:n}=r(27),s=e=>{const t=e.length,r=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[r]+e[r-1])/2:e[r]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?s(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));if(-1!==t){return n(e,t).map((e=>s(e)))}return s(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,r)=>{if(0===t[r])throw new Error("Cannot divide by 0");return e%t[r]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,r){const{transpose:n}=r(27),s=e=>{let t=0;const r={};return e.map((e=>{void 0===r[e]&&(r[e]=0),r[e]+=1,r[e]>t&&(t=r[e])})),Object.keys(r).filter((e=>r[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?s(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));if(-1!==t){return n(e,t).map((e=>s(e)))}return s(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,r)=>e*t[r]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){if(Array.isArray(e))return e.map((e=>180*e/Math.PI));return 180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,r){const{max:n}=r(26),{min:s}=r(28),{subtract:i}=r(29);e.exports={range:function(...e){return i(n(...e),s(...e))}}},function(e,t){const r=(e,t)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t=0){if(Array.isArray(e))return e.map((e=>r(e,t)));return r(e,t)}}},function(e,t){e.exports={sin:function(e){if(Array.isArray(e))return e.map((e=>Math.sin(e)));return Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,r){const{pow:n}=r(17);e.exports={square:function(e){return n(e,2)}}},function(e,t){const r=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(r,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){if(Array.isArray(e))return e.map((e=>Math.tan(e)));return Math.tan(e)}}},function(e,t){function r(e){return Array.isArray(e)?e.filter(((t,r)=>e.indexOf(t)===r)).length:1}e.exports={unique:r},r.skipNumberValidation=!0},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t){var r=Object.keys;t.equal=function(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;for(var n=r(e),s=n.length,i=0;i<s;i++)if(!(n[i]in t))return!1;for(i=0;i<s;i++)if(e[n[i]]!==t[n[i]])return!1;return s===r(t).length}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6);t.default=function(e,t,r){var s=n.useRef(void 0);s.current&&r(t,s.current)||(s.current=t),n.useEffect(e,s.current)}},function(e,t,r){"use strict";r.r(t),r.d(t,"Plugin",(function(){return plugin_ExpressionsPublicPlugin})),r.d(t,"ExpressionsPublicPlugin",(function(){return plugin_ExpressionsPublicPlugin})),r.d(t,"plugin",(function(){return F})),r.d(t,"ReactExpressionRenderer",(function(){return R})),r.d(t,"ExpressionRenderHandler",(function(){return render_ExpressionRenderHandler})),r.d(t,"buildExpression",(function(){return a.buildExpression})),r.d(t,"buildExpressionFunction",(function(){return a.buildExpressionFunction})),r.d(t,"Execution",(function(){return a.Execution})),r.d(t,"ExecutionContract",(function(){return a.ExecutionContract})),r.d(t,"Executor",(function(){return a.Executor})),r.d(t,"ExpressionFunction",(function(){return a.ExpressionFunction})),r.d(t,"ExpressionFunctionParameter",(function(){return a.ExpressionFunctionParameter})),r.d(t,"ExpressionRenderer",(function(){return a.ExpressionRenderer})),r.d(t,"ExpressionRendererRegistry",(function(){return a.ExpressionRendererRegistry})),r.d(t,"ExpressionType",(function(){return a.ExpressionType})),r.d(t,"FontStyle",(function(){return a.FontStyle})),r.d(t,"FontWeight",(function(){return a.FontWeight})),r.d(t,"format",(function(){return a.format})),r.d(t,"formatExpression",(function(){return a.formatExpression})),r.d(t,"FunctionsRegistry",(function(){return a.FunctionsRegistry})),r.d(t,"isExpressionAstBuilder",(function(){return a.isExpressionAstBuilder})),r.d(t,"Overflow",(function(){return a.Overflow})),r.d(t,"parse",(function(){return a.parse})),r.d(t,"parseExpression",(function(){return a.parseExpression})),r.d(t,"TextAlignment",(function(){return a.TextAlignment})),r.d(t,"TextDecoration",(function(){return a.TextDecoration})),r.d(t,"TypesRegistry",(function(){return a.TypesRegistry})),r.d(t,"ExpressionsService",(function(){return a.ExpressionsService})),r.d(t,"TablesAdapter",(function(){return a.TablesAdapter})),r.d(t,"ExpressionsInspectorAdapter",(function(){return a.ExpressionsInspectorAdapter})),r.d(t,"createDefaultInspectorAdapters",(function(){return a.createDefaultInspectorAdapters}));r(37);var n=r(0),s=r.n(n),i=r(3),o=r(14),a=r(5);class expressions_services_ExpressionsService extends a.ExpressionsService{setup({getStartServices:e}){return this.registerFunction(function({getStartServices:e}){return Object(a.getUiSettingFn)({async getStartDependencies(){const[{uiSettings:t}]=await e();return{uiSettings:t}}})}({getStartServices:e})),super.setup()}}const[u,c]=Object(o.createGetterSetter)("Notifications"),[l,p]=Object(o.createGetterSetter)("Renderers registry"),[d,f]=Object(o.createGetterSetter)("ExpressionsService");var h=r(32),m=r.n(h),g=r(6),v=r(33),y=r.n(v),x=r(4),b=r(20),A=r.n(b),w=r(19),E=r(34),_=r(2),j=r(1);const C=(e,t,r)=>{"AbortError"!==t.name?(u().toasts.addError(t,{title:j.i18n.translate("expressions.defaultErrorRenderer.errorTitle",{defaultMessage:"Error in visualisation"}),toastMessage:t.message}),r.done()):r.done()};class render_ExpressionRenderHandler{constructor(e,{onRenderError:t,renderMode:r,syncColors:n,interactive:o,hasCompatibleActions:a=(async()=>!1)}={}){s()(this,"render$",void 0),s()(this,"update$",void 0),s()(this,"events$",void 0),s()(this,"element",void 0),s()(this,"destroyFn",void 0),s()(this,"renderCount",0),s()(this,"renderSubject",void 0),s()(this,"eventsSubject",void 0),s()(this,"updateSubject",void 0),s()(this,"handlers",void 0),s()(this,"onRenderError",void 0),s()(this,"render",(async(e,t)=>{if(!e||"object"!=typeof e)return this.handleRenderError(new Error("invalid data provided to the expression renderer"));if("render"!==e.type||!e.as)return"error"===e.type?this.handleRenderError(e.error):this.handleRenderError(new Error("invalid data provided to the expression renderer"));if(!l().get(e.as))return this.handleRenderError(new Error(`invalid renderer id '${e.as}'`));try{await l().get(e.as).render(this.element,e.value,{...this.handlers,uiState:t})}catch(e){return this.handleRenderError(e)}})),s()(this,"destroy",(()=>{this.renderSubject.complete(),this.eventsSubject.complete(),this.updateSubject.complete(),this.destroyFn&&this.destroyFn()})),s()(this,"getElement",(()=>this.element)),s()(this,"handleRenderError",(e=>{this.onRenderError(this.element,e,this.handlers)})),this.element=e,this.eventsSubject=new _.Subject,this.events$=this.eventsSubject.asObservable(),this.onRenderError=t||C,this.renderSubject=new _.BehaviorSubject(null),this.render$=this.renderSubject.asObservable().pipe(Object(x.filter)(i.isNumber)),this.updateSubject=new _.Subject,this.update$=this.updateSubject.asObservable(),this.handlers={onDestroy:e=>{this.destroyFn=e},done:()=>{this.renderCount++,this.renderSubject.next(this.renderCount)},reload:()=>{this.updateSubject.next(null)},update:e=>{this.updateSubject.next(e)},event:e=>{this.eventsSubject.next(e)},getRenderMode:()=>r||"view",isSyncColorsEnabled:()=>n||!1,isInteractive:()=>null==o||o,hasCompatibleActions:a}}}function O(e,t,r){const n=new render_ExpressionRenderHandler(e,r);return n.render(t),n}class loader_ExpressionLoader{constructor(e,t,r){s()(this,"data$",void 0),s()(this,"update$",void 0),s()(this,"render$",void 0),s()(this,"events$",void 0),s()(this,"loading$",void 0),s()(this,"execution",void 0),s()(this,"renderHandler",void 0),s()(this,"dataSubject",void 0),s()(this,"loadingSubject",void 0),s()(this,"data",void 0),s()(this,"params",{}),s()(this,"subscription",void 0),s()(this,"loadData",((e,t)=>{var r;null===(r=this.subscription)||void 0===r||r.unsubscribe(),this.execution&&this.execution.isPending&&this.execution.cancel(),this.setParams(t),this.execution=d().execute(e,t.context,{searchContext:t.searchContext,variables:t.variables||{},inspectorAdapters:t.inspectorAdapters,searchSessionId:t.searchSessionId,debug:t.debug,syncColors:t.syncColors,executionContext:t.executionContext}),this.subscription=this.execution.getData().pipe(Object(x.delay)(0),Object(x.filter)((({partial:e})=>t.partial||!e)),t.partial&&t.throttle?Object(x.throttleTime)(t.throttle,_.asyncScheduler,{leading:!0,trailing:!0}):_.identity).subscribe((e=>this.dataSubject.next(e)))})),this.dataSubject=new _.Subject,this.data$=this.dataSubject.asObservable(),this.loadingSubject=new _.BehaviorSubject(!1),this.loading$=this.loadingSubject.asObservable().pipe(Object(x.filter)((e=>!0===e)),Object(x.map)((()=>{}))),this.renderHandler=new render_ExpressionRenderHandler(e,{interactive:null==r?void 0:r.interactive,onRenderError:r&&r.onRenderError,renderMode:null==r?void 0:r.renderMode,syncColors:null==r?void 0:r.syncColors,hasCompatibleActions:null==r?void 0:r.hasCompatibleActions}),this.render$=this.renderHandler.render$,this.update$=this.renderHandler.update$,this.events$=this.renderHandler.events$,this.update$.subscribe((e=>{if(e){const{newExpression:t,newParams:r}=e;this.update(t,r)}})),this.data$.subscribe((({result:e})=>{this.render(e)})),this.render$.subscribe((()=>{this.loadingSubject.next(!1)})),this.setParams(r),t&&(this.loadingSubject.next(!0),this.loadData(t,this.params))}destroy(){var e;this.dataSubject.complete(),this.loadingSubject.complete(),this.renderHandler.destroy(),this.cancel(),null===(e=this.subscription)||void 0===e||e.unsubscribe()}cancel(){var e;null===(e=this.execution)||void 0===e||e.cancel()}getExpression(){var e;return null===(e=this.execution)||void 0===e?void 0:e.getExpression()}getAst(){var e;return null===(e=this.execution)||void 0===e?void 0:e.getAst()}getElement(){return this.renderHandler.getElement()}inspect(){var e;return null===(e=this.execution)||void 0===e?void 0:e.inspect()}update(e,t){this.setParams(t),this.loadingSubject.next(!0),e?this.loadData(e,this.params):this.data&&this.render(this.data)}render(e){this.renderHandler.render(e,this.params.uiState)}setParams(e){var t,r;e&&Object.keys(e).length&&(e.searchContext&&(this.params.searchContext=Object(i.defaults)({},e.searchContext,this.params.searchContext||{})),e.uiState&&this.params&&(this.params.uiState=e.uiState),e.variables&&this.params&&(this.params.variables=e.variables),e.searchSessionId&&this.params&&(this.params.searchSessionId=e.searchSessionId),this.params.syncColors=e.syncColors,this.params.debug=Boolean(e.debug),this.params.partial=Boolean(e.partial),this.params.throttle=Number(null!==(t=e.throttle)&&void 0!==t?t:1e3),this.params.inspectorAdapters=e.inspectorAdapters||(null===(r=this.execution)||void 0===r?void 0:r.inspect()),this.params.executionContext=e.executionContext)}}const T=(e,t,r)=>new loader_ExpressionLoader(e,t,r);var M=r(9);const S={isEmpty:!0,isLoading:!1,error:null},R=({className:e,dataAttrs:t,padding:r,renderError:n,expression:s,onEvent:i,onData$:o,reload$:a,debounce:u,...c})=>{const l=Object(g.useRef)(null),[p,d]=Object(g.useState)({...S}),f=!!n,h=Object(g.useRef)(null),v=Object(g.useRef)(!1),b=Object(g.useRef)(null),[_,j]=Object(g.useState)(s),[C,O]=Object(g.useState)(!1),T=Object(g.useRef)(!0);A()((()=>{if(T.current)return void(T.current=!1);if(void 0===u)return;O(!0);const e=setTimeout((()=>{j(s),O(!1)}),u);return()=>{clearTimeout(e)}}),[s,c,u]);const R=void 0!==u?_:s;Object(g.useEffect)((()=>{const e=[];return h.current=new loader_ExpressionLoader(l.current,R,{...c,onRenderError:f?(e,t,r)=>{b.current=r,d((()=>({...S,isEmpty:!1,error:t}))),c.onRenderError&&c.onRenderError(e,t,r)}:c.onRenderError}),i&&e.push(h.current.events$.subscribe((e=>{i(e)}))),o&&e.push(h.current.data$.subscribe((({partial:e,result:t})=>{var r;o(t,null===(r=h.current)||void 0===r?void 0:r.inspect(),e)}))),e.push(h.current.loading$.subscribe((()=>{v.current=!1,d((e=>({...e,isLoading:!0})))})),h.current.render$.pipe(Object(x.filter)((()=>!v.current))).subscribe((e=>{d((()=>({...S,isEmpty:!1})))}))),()=>{e.forEach((e=>e.unsubscribe())),h.current&&(h.current.destroy(),h.current=null),b.current=null}}),[f,i,c.interactive,c.renderMode,c.syncColors]),Object(g.useEffect)((()=>{const e=null==a?void 0:a.subscribe((()=>{h.current&&h.current.update(R,c)}));return()=>null==e?void 0:e.unsubscribe()}),[a,R,...Object.values(c)]),A()((()=>{h.current&&!C&&h.current.update(R,c)}),void 0===u?[{activeExpression:R,...c}]:[{waitingForDebounceToComplete:C}]),Object(g.useLayoutEffect)((()=>{p.error&&b.current&&(v.current=!0,b.current.done(),b.current=null)}),[p.error]);const F=y()("expExpressionRenderer",e,{"expExpressionRenderer-isEmpty":p.isEmpty,"expExpressionRenderer-hasError":!!p.error}),N={};return r&&(N.padding=E.euiLightVars.paddingSizes[r]),Object(M.jsx)("div",m()({},t,{className:F}),p.isEmpty&&Object(M.jsx)(w.EuiLoadingChart,{mono:!0,size:"l"}),(p.isLoading||C)&&Object(M.jsx)(w.EuiProgress,{size:"xs",color:"accent",position:"absolute"}),!p.isLoading&&p.error&&n&&n(p.error.message,p.error),Object(M.jsx)("div",{className:"expExpressionRenderer__expression",style:N,ref:l}))};class plugin_ExpressionsPublicPlugin{constructor(e){s()(this,"expressions",new expressions_services_ExpressionsService)}configureExecutor(e){const{executor:t}=this.expressions;t.extendContext({environment:"client"})}setup(e){this.configureExecutor(e);const{expressions:t}=this,{renderers:r}=t;p(r),f(t);const n=t.setup(Object(i.pick)(e,"getStartServices"));return Object.freeze(n)}start(e){c(e.notifications);const{expressions:t}=this,r={...t.start(),ExpressionLoader:loader_ExpressionLoader,ExpressionRenderHandler:render_ExpressionRenderHandler,loader:T,ReactExpressionRenderer:R,render:O};return Object.freeze(r)}stop(){this.expressions.stop()}}function F(e){return new plugin_ExpressionsPublicPlugin(e)}}]);