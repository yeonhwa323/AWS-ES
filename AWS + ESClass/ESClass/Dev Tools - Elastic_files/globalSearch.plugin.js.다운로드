/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){var r={};function t(n){if(r[n])return r[n].exports;var s=r[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var s in e)t.d(n,s,function(r){return e[r]}.bind(null,s));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=9)}([function(e,r,t){e.exports=t(11)(1075)},function(e,r){e.exports=__kbnSharedDeps__.Rxjs},function(e,r){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,r){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var s=new Array(16);e.exports=function(){for(var e,r=0;r<16;r++)0==(3&r)&&(e=4294967296*Math.random()),s[r]=e>>>((3&r)<<3)&255;return s}}},function(e,r){for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,r){var n=r||0,s=t;return[s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]]].join("")}},function(e,r){e.exports=__kbnSharedDeps__.Lodash},function(e,r){e.exports=__kbnSharedDeps__.Moment},function(e,r){e.exports=__kbnSharedDeps__.KbnI18n},function(e,r,t){var n=t(12),s=t(13),i=s;i.v1=n,i.v4=s,e.exports=i},function(e,r,t){t(10),__kbnBundles__.define("plugin/globalSearch/public",t,14)},function(e,r,t){t.p=window.__kbnPublicPath__.globalSearch},function(e,r){e.exports=__kbnSharedDeps_npm__},function(e,r,t){var n,s,i=t(3),a=t(4),o=0,c=0;e.exports=function(e,r,t){var l=r&&t||0,u=r||[],h=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:s;if(null==h||null==p){var d=i();null==h&&(h=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=s=16383&(d[6]<<8|d[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),b=void 0!==e.nsecs?e.nsecs:c+1,v=f-o+(b-c)/1e4;if(v<0&&void 0===e.clockseq&&(p=p+1&16383),(v<0||f>o)&&void 0===e.nsecs&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=f,c=b,s=p;var g=(1e4*(268435455&(f+=122192928e5))+b)%4294967296;u[l++]=g>>>24&255,u[l++]=g>>>16&255,u[l++]=g>>>8&255,u[l++]=255&g;var _=f/4294967296*1e4&268435455;u[l++]=_>>>8&255,u[l++]=255&_,u[l++]=_>>>24&15|16,u[l++]=_>>>16&255,u[l++]=p>>>8|128,u[l++]=255&p;for(var y=0;y<6;++y)u[l+y]=h[y];return r||a(u)}},function(e,r,t){var n=t(3),s=t(4);e.exports=function(e,r,t){var i=r&&t||0;"string"==typeof e&&(r="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,r)for(var o=0;o<16;++o)r[i+o]=a[o];return r||s(a)}},function(e,r,t){"use strict";t.r(r),t.d(r,"plugin",(function(){return b}));var n=t(0),s=t.n(n);class license_checker_LicenseChecker{constructor(e){s()(this,"subscription",void 0),s()(this,"state",{valid:!1,message:"unknown"}),this.subscription=e.subscribe((e=>{this.state=(e=>{const r=e.check("globalSearch","basic");switch(r.state){case"expired":return{valid:!1,message:"expired"};case"invalid":return{valid:!1,message:"invalid"};case"unavailable":return{valid:!1,message:"unavailable"};case"valid":return{valid:!0};default:throw new Error(`Invalid license state: ${r.state}`)}})(e)}))}getState(){return this.state}clean(){this.subscription.unsubscribe()}}var i=t(1),a=t(2),o=t(5),c=t(6),l=t(7);class GlobalSearchFindError extends Error{static invalidLicense(e){return new GlobalSearchFindError("invalid-license",e)}constructor(e,r){super(r),this.type=e,Object.setPrototypeOf(this,GlobalSearchFindError.prototype)}}class TakeInArray{constructor(e){if(this.total=e,this.total<0)throw new Error("Cannot take a negative number of items")}call(e,r){return r.subscribe(new take_in_array_TakeInArraySubscriber(e,this.total))}}class take_in_array_TakeInArraySubscriber extends i.Subscriber{constructor(e,r){super(e),s()(this,"current",0),this.total=r}_next(e){const r=this.total-this.current;r>e.length?(this.destination.next(e),this.current+=e.length):(this.destination.next(e.slice(0,r)),this.destination.complete(),this.unsubscribe())}}const u=(e,r)=>"string"==typeof e?e.startsWith("/")?r.prepend(e):e:e.prependBasePath?r.prepend(e.path):e.path;var h=t(8),p=t.n(h);const d="globalSearch:defaultPref",f=()=>{};class search_service_SearchService{constructor(){s()(this,"providers",new Map),s()(this,"config",void 0),s()(this,"http",void 0),s()(this,"maxProviderResults",40),s()(this,"licenseChecker",void 0),s()(this,"serverTypes",void 0)}setup({config:e,maxProviderResults:r=40}){return this.config=e,this.maxProviderResults=r,{registerResultProvider:e=>{if(this.providers.has(e.id))throw new Error(`trying to register duplicate provider: ${e.id}`);this.providers.set(e.id,e)}}}start({http:e,licenseChecker:r}){return this.http=e,this.licenseChecker=r,{find:(e,r)=>this.performFind(e,r),getSearchableTypes:()=>this.getSearchableTypes()}}async getSearchableTypes(){const e=(await Promise.all([...this.providers.values()].map((e=>e.getSearchableTypes())))).flat();return this.serverTypes||(this.serverTypes=await(async e=>{const{types:r}=await e.get("/internal/global_search/searchable_types");return r})(this.http)),Object(o.uniq)([...e,...this.serverTypes])}performFind(e,r){var t;const n=this.licenseChecker.getState();if(!n.valid)return Object(i.throwError)(GlobalSearchFindError.invalidLicense(l.i18n.translate("xpack.globalSearch.find.invalidLicenseError",{defaultMessage:"GlobalSearch API is disabled because of invalid license state: {errorMessage}",values:{errorMessage:n.message}})));const s=Object(c.duration)(this.config.search_timeout).asMilliseconds(),o=Object(i.timer)(s).pipe(Object(a.map)(f)),h=r.aborted$?Object(i.merge)(r.aborted$,o):o,b=null!==(t=r.preference)&&void 0!==t?t:((e=window.sessionStorage)=>{let r=e.getItem(d);return r||(r=p.a.v4(),e.setItem(d,r),r)})(),v={...r,preference:b,maxResults:this.maxProviderResults,aborted$:h},g=e=>((e,r)=>({...e,url:u(e.url,r)}))(e,this.http.basePath),_=((e,r,{preference:t,aborted$:n})=>{var s;let o;return n&&(o=new AbortController,n.subscribe((()=>{o.abort()}))),Object(i.from)(e.post("/internal/global_search/find",{body:JSON.stringify({params:r,options:{preference:t}}),signal:null===(s=o)||void 0===s?void 0:s.signal})).pipe(Object(a.takeUntil)(null!=n?n:i.EMPTY),Object(a.map)((e=>e.results)))})(this.http,e,{preference:b,aborted$:h}).pipe(Object(a.catchError)((()=>i.EMPTY))),y=[...this.providers.values()].map((r=>{return r.find(e,v).pipe(Object(a.catchError)((()=>i.EMPTY)),(t=this.maxProviderResults,function(e){return 0===t?i.EMPTY:e.lift(new TakeInArray(t))}),Object(a.takeUntil)(h),Object(a.map)((e=>e.map((e=>g(e))))));var t}));return Object(i.merge)(...y,_).pipe(Object(a.map)((e=>({results:e}))))}}class plugin_GlobalSearchPlugin{constructor(e){s()(this,"config",void 0),s()(this,"licenseChecker",void 0),s()(this,"searchService",new search_service_SearchService),this.config=e.config.get()}setup(e){const{registerResultProvider:r}=this.searchService.setup({config:this.config});return{registerResultProvider:r}}start({http:e},{licensing:r}){this.licenseChecker=new license_checker_LicenseChecker(r.license$);const{find:t,getSearchableTypes:n}=this.searchService.start({http:e,licenseChecker:this.licenseChecker});return{find:t,getSearchableTypes:n}}stop(){this.licenseChecker&&this.licenseChecker.clean()}}const b=e=>new plugin_GlobalSearchPlugin(e)}]);